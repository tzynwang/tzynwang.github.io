<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BScVxmeO.js"></script><!-- Google Tag Manager --><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', ga4Id);
    })();</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KM9SGJLK">(function(){const gTagId = "GTM-KM9SGJLK";
})();</script><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', ga4Id);
    })();</script><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦Š</text></svg>"><link rel="sitemap" href="/sitemap-index.xml"><meta name="generator" content="Astro v5.1.2"><!-- Primary Meta Tags --><title>ã€Œä½¿ç”¨passportè™•ç†FBã€Googleç¬¬ä¸‰æ–¹ç™»å…¥ã€ç›¸é—œç­†è¨˜</title><meta name="title" content="ã€Œä½¿ç”¨passportè™•ç†FBã€Googleç¬¬ä¸‰æ–¹ç™»å…¥ã€ç›¸é—œç­†è¨˜"><meta name="description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tzynwang.github.io/2021/express-passport-facebook-google-line"><meta property="og:title" content="ã€Œä½¿ç”¨passportè™•ç†FBã€Googleç¬¬ä¸‰æ–¹ç™»å…¥ã€ç›¸é—œç­†è¨˜"><meta property="og:description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tzynwang.github.io/2021/express-passport-facebook-google-line"><meta property="twitter:title" content="ã€Œä½¿ç”¨passportè™•ç†FBã€Googleç¬¬ä¸‰æ–¹ç™»å…¥ã€ç›¸é—œç­†è¨˜"><meta property="twitter:description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet"><style>.tag[data-astro-cid-2iymvi75]{position:relative;display:inline-flex;align-items:center;padding:2px 8px;font-size:14px;font-weight:400;text-decoration:none;background-color:#8aa6a3;color:#fff;transition:background-color .2s ease-in-out}.tag[data-astro-cid-2iymvi75]:not(:last-of-type){margin-right:8px}.tag[data-astro-cid-2iymvi75]:hover{background-color:#127369}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}.footer[data-astro-cid-qlgq3onj]{padding:36px;text-align:center}.bottom[data-astro-cid-qlgq3onj]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.side-content[data-astro-cid-75hifxor],.main-content[data-astro-cid-75hifxor]{margin:24px}nav[data-astro-cid-75hifxor]{display:flex;gap:16px}@media screen and (min-width: 800px){body{height:100vh;display:flex;flex-direction:row;overflow-y:hidden}nav[data-astro-cid-75hifxor]{flex-direction:column}.side-content[data-astro-cid-75hifxor]{flex:0 0 240px}.main-content[data-astro-cid-75hifxor]{margin:0;padding:40px 24px 0;flex:1 1 auto;overflow-y:auto;position:relative}}*{margin:0;padding:0;box-sizing:content-box;font-family:sans-serif;text-wrap:pretty;color:#000000e6}html{background-color:#bfbfbf66}a{color:#127369;font-weight:700;text-decoration:underline;text-decoration-color:transparent;transition:text-decoration-color .2s ease-in-out}a:hover{text-decoration-color:#127369}a.link-out{position:absolute;inset:0}ul,li{list-style-position:inside}ul:not(:has(li)){margin-top:16px;margin-bottom:16px}li{margin-top:4px;margin-bottom:4px;line-height:24px}li li{padding-left:16px}img{display:block;max-width:100%}h1,h2{font-size:28px;line-height:42px;margin:16px 0;color:#4c5958}h3,h4{font-size:22px;line-height:34px;margin:16px 0;color:#4c5958}h5{font-size:18px;line-height:28px;margin:4px 0;color:#4c5958}p{font-size:16px;line-height:24px;margin:16px 0}p code{font-size:14px}blockquote{padding-left:16px;border-left:4px solid #4c5958}blockquote *{font-family:Noto Sans,sans-serif}pre{padding:8px 16px}code,code span{font-family:monospace}hr{width:100%;height:1px;margin:16px 0;background-color:#4c5958}del{color:#4c5958e6}ol>li:has(p)>p{display:inline;margin:0}
.post-container[data-astro-cid-qtokga5y] h1[data-astro-cid-qtokga5y]{margin:0 0 16px}.info[data-astro-cid-qtokga5y]{display:flex;flex-direction:column;gap:8px}.toc-container[data-astro-cid-qtokga5y]{margin-bottom:0}.toc-container[data-astro-cid-qtokga5y]>li[data-astro-cid-qtokga5y]:not(:last-of-type){margin-bottom:4px}.toc-2[data-astro-cid-qtokga5y]{margin-left:1rem}.toc-3[data-astro-cid-qtokga5y]{margin-left:2rem}.toc-4[data-astro-cid-qtokga5y]{margin-left:3rem}.toc-5[data-astro-cid-qtokga5y]{margin-left:4rem}@media screen and (min-width: 800px){.post-container[data-astro-cid-qtokga5y]{max-width:600px}}@media screen and (min-width: 1200px){.post-container[data-astro-cid-qtokga5y]{max-width:720px}}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KM9SGJLK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <section class="side-content" data-astro-cid-75hifxor> <h1 data-astro-cid-75hifxor>æ™®é€šæ–‡çµ„ 2.0</h1> <nav data-astro-cid-75hifxor> <a href="/" data-astro-cid-75hifxor>é¦–é </a> <a href="/archive" data-astro-cid-75hifxor>å…¨æ–‡ç« æ­¸æª”</a> <a href="/tag" data-astro-cid-75hifxor>ä»¥æ¨™ç±¤æª¢è¦–</a> <a href="/rss.xml" data-astro-cid-75hifxor>RSS</a> </nav> </section> <section class="main-content" data-astro-cid-75hifxor>   <div class="post-container" data-astro-cid-qtokga5y> <h1 data-astro-cid-qtokga5y>ã€Œä½¿ç”¨passportè™•ç†FBã€Googleç¬¬ä¸‰æ–¹ç™»å…¥ã€ç›¸é—œç­†è¨˜</h1> <div class="info" data-astro-cid-qtokga5y> <span data-astro-cid-qtokga5y>2021-06-30 12:59</span> <span data-astro-cid-qtokga5y><a class="tag" href="/tag/Express" data-astro-cid-2iymvi75> Express </a> </span> <ul class="toc-container" data-astro-cid-qtokga5y> <li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç¸½çµ" data-astro-cid-qtokga5y>ç¸½çµ</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç’°å¢ƒ" data-astro-cid-qtokga5y>ç’°å¢ƒ</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç­†è¨˜" data-astro-cid-qtokga5y>ç­†è¨˜</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#å°ˆæ¡ˆçµæ§‹" data-astro-cid-qtokga5y>å°ˆæ¡ˆçµæ§‹</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#fb-æµç¨‹" data-astro-cid-qtokga5y>FB æµç¨‹</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#google-æµç¨‹" data-astro-cid-qtokga5y>Google æµç¨‹</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#line-æµç¨‹" data-astro-cid-qtokga5y>LINE æµç¨‹</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#authjs-å…§å®¹" data-astro-cid-qtokga5y>auth.js å…§å®¹</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#appjs-è¨­å®š" data-astro-cid-qtokga5y>app.js è¨­å®š</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#é—œæ–¼-oauth-20" data-astro-cid-qtokga5y>é—œæ–¼ OAuth 2.0</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#authentication" data-astro-cid-qtokga5y>Authentication</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#authorization" data-astro-cid-qtokga5y>Authorization</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#åƒè€ƒæ–‡ä»¶" data-astro-cid-qtokga5y>åƒè€ƒæ–‡ä»¶</a> </li> </ul> </div> <h2 id="ç¸½çµ">ç¸½çµ</h2>
<p>ä½¿ç”¨ npm package <code>passport-facebook</code>ã€<code>passport-google-oauth20</code>èˆ‡<code>passport-line</code>è®“ Todo List å°ˆæ¡ˆå¯ä»¥é€é FBã€Google æˆ– LINE å¸³è™Ÿé€²è¡Œç¬¬ä¸‰æ–¹ç™»å…¥</p>
<h2 id="ç’°å¢ƒ">ç’°å¢ƒ</h2>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>passport: 0.4.1</span></span>
<span class="line"><span>passport-facebook: 3.0.0</span></span>
<span class="line"><span>passport-google-oauth20: 2.0.0</span></span>
<span class="line"><span>passport-line: 0.0.4</span></span>
<span class="line"><span>os: Windows_NT 10.0.18363 win32 x64</span></span></code></pre>
<h2 id="ç­†è¨˜">ç­†è¨˜</h2>
<h3 id="å°ˆæ¡ˆçµæ§‹">å°ˆæ¡ˆçµæ§‹</h3>
<p>åƒ…åˆ—å‡ºèˆ‡æœ¬æ¬¡å¯¦ä½œç›¸é—œçš„è³‡æ–™å¤¾èˆ‡æª”æ¡ˆï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>config</span></span>
<span class="line"><span>  passport_FB.js</span></span>
<span class="line"><span>  passport_Google.js</span></span>
<span class="line"><span>  passport_LINE.js</span></span>
<span class="line"><span>models</span></span>
<span class="line"><span>  user.js</span></span>
<span class="line"><span>routes</span></span>
<span class="line"><span>  modules</span></span>
<span class="line"><span>    auth.js</span></span>
<span class="line"><span>app.js</span></span></code></pre>
<h3 id="fb-æµç¨‹">FB æµç¨‹</h3>
<script src="https://gist.github.com/tzynwang/7b5d441f8127653fac09bbebd9a9ac0f.js"></script>
<p><img src="/2021/express-passport-facebook-google-line/fb_dashboard.jpg" alt="fb dashboard"></p>
<p>clientID èˆ‡ clientSecret éƒ½å¯åœ¨ FB é–‹ç™¼è€…å¾Œå°å–å¾—</p>
<h3 id="google-æµç¨‹">Google æµç¨‹</h3>
<script src="https://gist.github.com/tzynwang/26b84e1bfaccf5dc353ad01b0d2cfd65.js"></script>
<p>å¾Œå°æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>é€²å…¥ GCP å¾Œé¸æ“‡ APIs &#x26; Serviceï¼Œé¸æ“‡ Credentials ä¸¦å»ºç«‹æ–°çš„ Oath client ID</p>
<p><img src="/2021/express-passport-facebook-google-line/Google_step1.jpg" alt="Google step 1"></p>
</li>
<li>
<p>æ‡‰ç”¨ç¨‹å¼é¡å‹å› æ‡‰ç·´ç¿’å°ˆæ¡ˆé¸æ“‡ Web application</p>
<p><img src="/2021/express-passport-facebook-google-line/Google_step2.jpg" alt="Google step 2"></p>
</li>
<li>
<p>èˆ‡ FB è¼ƒç‚ºä¸åŒï¼ŒAuthorized redirect URIs ç‚ºå¿…å¡«ï¼Œç·´ç¿’æƒ…æ³ä¸‹ç›´æ¥å°å›<code>localhost:3000/&#x3C;auth/google/callback></code>å³å¯ï¼ˆå‰è¿°<code>&#x3C;></code>å…§å®¹èˆ‡ endpoint è¨­å®šä¸€è‡´ï¼‰</p>
<p><a href="/2021/express-passport-facebook-google-line/Google_step3.jpg">Google step 3</a></p>
</li>
</ol>
<h3 id="line-æµç¨‹">LINE æµç¨‹</h3>
<script src="https://gist.github.com/tzynwang/21340bfe58134bb6e1cb6a07e9def494.js"></script>
<p>å®˜æ–¹èªªæ˜æ–‡ä»¶ï¼š</p>
<ul>
<li><a href="https://developers.line.biz/en/docs/line-login/integrate-line-login/">Integrating LINE Login with your web app</a></li>
<li><a href="https://developers.line.biz/zh-hant/docs/line-login/integrate-line-login/">æ•´åˆ LINE Login èˆ‡ web app</a></li>
</ul>
<p>å®˜æ–¹ç”³è«‹å…¥å£ï¼š<a href="https://developers.line.biz/en/services/line-login/">LINE Developer: Products / LINE Login</a></p>
<p>å¾Œå°æµç¨‹å¦‚ä¸‹ï¼š</p>
<ol>
<li>
<p>èˆ‡ FB ä»¥åŠ Google è¼ƒä¸åŒï¼ŒLINE æ­é… passport è™•ç†ç¬¬ä¸‰æ–¹ç™»å…¥æœƒç”¨åˆ°çš„æ˜¯<strong>Channel</strong> ID èˆ‡<strong>Channel</strong> Secretï¼Œå…©ç­†è³‡æ–™å¯åœ¨ Basic Settings ä¸­è¤‡è£½</p>
<p><img src="/2021/express-passport-facebook-google-line/LINE_dashboard1.jpg" alt="LINE step 1">
<img src="/2021/express-passport-facebook-google-line/LINE_dashboard2.jpg" alt="LINE step 2"></p>
</li>
<li>
<p>åˆ‡æ›åˆ° LINE Login åˆ†é ï¼Œè¨­å®š Callback URL</p>
<p><img src="/2021/express-passport-facebook-google-line/LINE_dashboard3.jpg" alt="LINE step 3"></p>
</li>
<li>
<p>å…¶é¤˜æµç¨‹èˆ‡ FB ä»¥åŠ Google ç™»å…¥çš„å·®ç•°æ˜¯ï¼Œé€é LINE å‘ä½¿ç”¨è€…è¦æ±‚æˆæ¬Šæ™‚ï¼Œä¸éœ€è¦å¸¶å…¥<code>scope</code>è³‡æ–™ï¼ˆåƒè€ƒä»¥ä¸‹<code>auth.js</code>ç¬¬ 32 è¡Œï¼Œèˆ‡ FB ä»¥åŠ Google çš„å…§å®¹ä¸åŒï¼‰</p>
</li>
</ol>
<p>è£œå……ï¼š</p>
<ul>
<li>LINE Login<strong>ä¸æœƒ</strong>ä¸»å‹•æä¾›ä½¿ç”¨è€…çš„ Email è³‡è¨Šï¼Œè‹¥é ˆè«‹æ±‚ä½¿ç”¨è€…çš„ Emailï¼Œé–‹ç™¼è€…è¦è‡ªè¡Œç”³è«‹ Email address permission</li>
<li>åƒè€ƒï¼š<a href="https://developers.line.biz/en/docs/line-login/integrate-line-login/#applying-for-email-permission">Requesting permission to access the userâ€™s email address</a></li>
</ul>
<h3 id="authjs-å…§å®¹">auth.js å…§å®¹</h3>
<script src="https://gist.github.com/tzynwang/302a2a4b7098456bcd09f233093946a6.js"></script>
<h3 id="appjs-è¨­å®š">app.js è¨­å®š</h3>
<script src="https://gist.github.com/tzynwang/e9758c91408f8062498e2ef7f3ea6207.js"></script>
<p>è¨˜å¾—<code>require</code>åœ¨ config è³‡æ–™å¤¾ä¸­è¨­å®šå¥½çš„<code>passport_FB</code>èˆ‡<code>passport_Google</code>ä¸¦å‘¼å«ä¹‹å³å¯</p>
<h2 id="é—œæ–¼-oauth-20">é—œæ–¼ OAuth 2.0</h2>
<blockquote>
<p>OAuth allows you (the User) to grant access to your private resources on one site (which is called the Service Provider), to another site (called Consumer). While OpenID is all about using a single identity to sign into many sites, OAuth is about <strong>giving access to your stuff without sharing your identity at all</strong> (or its secret parts).</p>
</blockquote>
<p>Reference: <a href="https://hueniversedotcom.wordpress.com/2007/09/05/explaining-oauth/">Eran Hammer-Lahav: Explaining OAuth</a></p>
<h3 id="authentication">Authentication</h3>
<ul>
<li>Authentication is about <strong>proving you are the correct person</strong> because you know things.</li>
<li>Authentication means <strong>confirming your own identity</strong> (is the account and password correct?)</li>
<li>ï¼ˆé€éæä¾›æ­£ç¢ºçš„å¸³è™Ÿå¯†ç¢¼çµ„åˆï¼‰è­‰æ˜æˆ‘æ˜¯èª°</li>
</ul>
<h3 id="authorization">Authorization</h3>
<ul>
<li>Authorization is <strong>asking for permission</strong> to do stuff.</li>
<li>Authorization means <strong>granting access</strong> (is this user same as the one that just be authenticated?) to the system.</li>
<li><a href="https://oauth.net/2/">OAuth 2.0</a>: is the industry-standard protocol for <strong>authorization</strong>.</li>
<li>å…è¨±å“ªäº› APP ä¾†å­˜å–è³‡æ–™ï¼›ä»¥æœ¬æ¬¡ç·´ç¿’ä¾†èªªï¼Œå°±æ˜¯ã€Œæˆ‘åŒæ„æ­¤ Todo list å°ˆæ¡ˆå¯ä»¥å­˜å–æˆ‘åœ¨ FB æˆ–æ˜¯ Google å¸³è™Ÿä¸­çš„éƒ¨åˆ†è³‡æ–™ã€</li>
</ul>
<h2 id="åƒè€ƒæ–‡ä»¶">åƒè€ƒæ–‡ä»¶</h2>
<ul>
<li><a href="https://youtu.be/o9e3ex-axzA">YouTube: Express (NodeJS) - Google oAuth 2.0 (passportJS)</a></li>
<li>OAuth 2.0
<ul>
<li><a href="https://www.digitalocean.com/community/tutorials/an-introduction-to-oauth-2">DigitalOcean: An Introduction to OAuth 2</a></li>
<li><a href="https://www.varonis.com/blog/what-is-oauth/">What is OAuth? Definition and How it Works</a></li>
</ul>
</li>
</ul> </div>   <footer class="footer" data-astro-cid-qlgq3onj>
Tzu Yin (Charlie) ğŸ¦Š Made in Taiwan
</footer>  </section>  </body></html> 