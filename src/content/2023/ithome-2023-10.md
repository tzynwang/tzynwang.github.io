---
title: æ¨æ£„ create-react-app ä¹‹é¤˜é‚„æ¶äº†å€‹ astro blog æ˜­å‘Šå¤©ä¸‹ï¼šwebpack 5 èˆ‡åœ–ç‰‡è³‡æº
date: 2023-09-25 08:06:36
tag:
- [2023éµäººè³½]
- [Frontend Infrastructure]
- [webpack]
banner: /2023/ithome-2023-10/sarandy-westfall-L6lA84MaEdw-unsplash.jpg
summary: ä¾†èŠèŠå¦‚ä½•è¨­å®š webpack è®“å…¶å¯ä»¥è™•ç†å‰ç«¯å¸¸ç”¨åˆ°çš„éœæ…‹è³‡æºï¼ˆ.jpg/.png/.svgï¼‰ï¼Œä¸¦æ­é… @svgr/webpack è®“ .svg æ ¼å¼çš„æª”æ¡ˆå¯ä»¥ä»¥ã€Œå…ƒä»¶ã€å½¢å¼ä½¿ç”¨
draft:
---

ä»Šå¤©æœƒå…ˆåˆ†äº«å€‹äººæ…£ç”¨çš„éœæ…‹è³‡æºè¨­å®šï¼Œæ¥è‘—æœƒä»‹ç´¹æˆ‘æ»¿å–œæ­¡çš„ svg loader [@svgr/webpack](https://react-svgr.com/docs/webpack/)ã€‚é€™å€‹å¥—ä»¶èƒ½è®“ `.svg` ç›´æ¥ä»¥ã€Œå…ƒä»¶ã€çš„å½¢å¼è¢«å¼•ç”¨ï¼š

```tsx
import EditIcon from './edit_icon.svg';

function EditButton() {
  return (
    <button>
      <EditIcon /> edit profile
    </button>
  );
}
```

é‚£éº½é–‹å§‹å§ (`ãƒ»Ï‰ãƒ»Â´)

## webpack è¨­å®š

### ä»¥è·¯å¾‘å½¢å¼ä½¿ç”¨åœ–ç‰‡

é¦–å…ˆåœ¨ webpack è¨­å®šä¸­åŠ ä¸Šä»¥ä¸‹å…§å®¹ï¼š

```ts
const webpackDevelopmentConfig: WebpackConfiguration = {
  module: {
    rules: [
      {
        test: /\.(png|svg|jpg)$/i,
        type: 'asset/resource',
        resourceQuery: /url/,
      },
    ],
  },
};
```

æ²’éŒ¯ï¼Œåœ¨ webpack 5 çš„æ™‚ä»£è£¡ï¼Œå–ç”¨éœæ…‹è³‡æºä¸å¼·åˆ¶è¦æ±‚å®‰è£å¥—ä»¶ `raw-loader` / `url-loader` / `file-loader` äº†ã€‚

> [webpack](https://webpack.js.org/guides/asset-modules/): Asset Modules types **replace all of these loaders** by adding 4 new module types.

ä»¥ä¸Šé€™æ®µè¦å‰‡åœ¨åšçš„äº‹æƒ…æ˜¯ï¼šç•¶åµæ¸¬åˆ°æª”æ¡ˆè·¯å¾‘ç¬¦åˆ `.png?url` / `.svg?url` / `.jpg?url` æ™‚ï¼Œwebpack æœƒæä¾›è©²æª”æ¡ˆåœ¨ç€è¦½å™¨ç’°å¢ƒä¸­å¯ä»¥ä½¿ç”¨çš„è·¯å¾‘ã€‚

> [webpack](https://webpack.js.org/guides/asset-modules/): `asset/resource` emits a separate file and **exports the URL**. Previously achievable by using `file-loader`.

æ‰€ä»¥ç¾åœ¨ä½ å¯ä»¥åœ¨å°ˆæ¡ˆå…§ä½¿ç”¨ä»¥ä¸‹æ–¹å¼é‹ç”¨ `./src/asset` è³‡æ–™å¤¾ä¸­çš„åœ–ç‰‡æª”æ¡ˆäº†ï¼š

```ts
import React from 'react';
import foxImageUrl from '@Asset/alexander-andrews-unsplash.jpg?url';

function Image() {
  return <img src={foxImageUrl} alt="fox image" />;
}

export default Image;
```

è¨˜å¾— import è·¯å¾‘çµå°¾è¦åŠ ä¸Šæˆ‘å€‘åœ¨ webpack è¦å‰‡ä¸­è¨­å®šå¥½çš„ resourceQuery `url`ã€‚

### ä»¥å…ƒä»¶å½¢å¼ä½¿ç”¨ svg

å…ˆå®‰è£ `@svgr/webpack`ï¼Œç„¶å¾Œè¿½åŠ ä»¥ä¸‹è¨­å®šï¼š

```ts
const webpackDevelopmentConfig: WebpackConfiguration = {
  module: {
    rules: [
      {
        test: /\.(png|svg|jpg)$/i,
        type: 'asset/resource',
        resourceQuery: /url/,
      },
      {
        test: /\.svg$/i,
        issuer: /\.tsx?$/,
        resourceQuery: { not: [/url/] },
        use: [
          {
            loader: '@svgr/webpack',
            options: {
              svgo: false,
            },
          },
        ],
      },
    ],
  },
};
```

é€é `test: /\.svg$/i`ã€`resourceQuery: { not: [/url/] }` èˆ‡ `issuer: /\.tsx?$/` ä¾†è™•ç†ã€Œæ‰€æœ‰ `.tsx` ä¸­çµå°¾ä¸ç‚º `.svg?url` çš„å…§å®¹ã€ã€‚é‡åˆ°ç¬¦åˆå‰è¿°æ¢ä»¶çš„æª”æ¡ˆæ™‚ï¼Œä½¿ç”¨ `@svgr/webpack` ä¾†è™•ç†ä¹‹ã€‚

é€™é‚Šæ¯”è¼ƒå¼”è©­çš„åœ°æ–¹æ˜¯è¨­å®š `svgo: false` ä¾†è®“ css é‡å° svg çš„å°ºå¯¸è¨­å®šå¯ä»¥é †åˆ©è¢«å¥—ç”¨ä¸Šå»ã€‚åªå¯«æˆ `use: ['@svgr/webpack']` æˆ–æ˜¯ä½¿ç”¨ [svgo å®˜æ–¹å»ºè­°çš„è§£æ±ºæ–¹å¼](https://github.com/svg/svgo#svg-wont-scale-when-css-is-applied-on-it)åœ¨å€‹äººçš„å¯¦é©—çµæœä¸­éƒ½æ˜¯å¤±æ•—çš„ï¼ˆsvg ç„¡æ³•é€é css èª¿æ•´å°ºå¯¸ï¼‰ã€‚

ğŸ¤·

## æ›´æ–° src/env.d.ts

è«‹å°‡ä»¥ä¸‹å…§å®¹åŠ åˆ° `./src/env.d.ts` ä¸­ã€‚é€™èƒ½è®“ TypeScript çŸ¥é“ã€Œè·¯å¾‘çµå°¾ç‚º `.(jpg|png|svg)?url` çš„æª”æ¡ˆæœƒæ˜¯æ–‡å­—å‹åˆ¥ã€ï¼Œè€Œã€Œè·¯å¾‘çµå°¾ç‚º `.svg` çš„æª”æ¡ˆæœƒæ˜¯ä¸€å€‹ React å…ƒä»¶ä¸”æ“æœ‰ html svg element çš„ç‰¹æ€§ï¼ˆpropsï¼‰ã€ã€‚

```ts
declare module '*.jpg?url' {
  const src: string;
  export default src;
}

declare module '*.png?url' {
  const src: string;
  export default src;
}

declare module '*.svg?url' {
  const src: string;
  export default src;
}

declare module '*.svg' {
  import React from 'react';
  const ReactComponent: React.FunctionComponent<React.SVGProps<SVGSVGElement>>;
  export default ReactComponent;
}
```

å®Œæˆï¼ç¾åœ¨ä½ çš„å°ˆæ¡ˆèƒ½å¤ æ­£å¸¸é¡¯ç¤ºåœ–ç‰‡å…§å®¹äº† (`ï½¥âˆ€ï½¥)b

## è£œå……ï¼šå¦‚ä½•é¸æ“‡åœ–ç‰‡æ ¼å¼

ç¶œåˆå¹³å¸¸çš„é–‹ç™¼ç¶“é©—ä»¥åŠåƒè€ƒ [web.dev: Choose the right image format](https://web.dev/choose-the-right-image-format/) ä¸€æ–‡ï¼Œå€‹äººé€šå¸¸æœƒä»¥ä»¥ä¸‹æµç¨‹ä¾†åˆ¤æ–·æœ€çµ‚è¦ä½¿ç”¨å“ªä¸€ç¨®æ ¼å¼ä¾†é¡¯ç¤ºåœ–ç‰‡ï¼š

1. éœ€è¦æ”¯æ´é€æ˜åº¦ï¼šæ²’ä»€éº¼é¸æ“‡ï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯ `png`
2. ç…§ç‰‡ã€ä¸æ˜¯è‰²å¡Šåˆ†æ˜çš„åœ–é¢ï¼šä½¿ç”¨ `jpg`
3. è‰²å¡Šåˆ†æ˜çš„åœ–ç‰‡ï¼ˆå¦‚ç¶²ç«™ logo ç­‰ï¼‰ï¼šä½¿ç”¨ `svg` æˆ– `png`

ç¢ºå®šæ ¼å¼å¾Œï¼Œæˆ‘æœƒå†æ ¹æ“šåœ–ç‰‡å¯¦éš›çš„å±•ç¤ºä½ç½®æ±ºå®šæ˜¯å¦[èª¿æ•´æª”æ¡ˆå°ºå¯¸](https://squoosh.app/)ã€‚é™¤äº† landing page é€™é¡å¤§é¢ç©å€å¡Šå¤–ï¼ŒåŸºæœ¬ä¸Šåœ–ç‰‡éƒ½å¯ä»¥ç¸®å°æˆã€Œç•«é¢ä¸Šå¯¦éš›å±•ç¤ºçš„å¤§å°ã€å³å¯ã€‚

é›–ç„¶ç¾åœ¨æ˜¯ä¸éœ€è¦ç‰¹åˆ¥æ–¤æ–¤è¨ˆè¼ƒæµé‡çš„æ™‚ä»£ï¼Œä½†ç„¡æ„ç¾©åœ°ä½¿ç”¨å¤§åœ–ç‰‡ä¹Ÿæœƒé€ æˆ lighthouse è©•åˆ†ä½è½ã€‚é–‹ç™¼æ™‚è‹¥é‚„æœ‰é¤˜è£•çš„è©±ï¼Œä¸Šåœ–æ™‚ç¨å¾®æ³¨æ„ä¸€ä¸‹ä¹Ÿæ²’æœ‰æå¤± ğŸ˜ˆ
