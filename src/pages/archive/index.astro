---
import Html from '@Components/layout/Html.astro';
import PostItem from '@Components/element/PostItem.astro';
import { sortPostByDate, groupPostByYear } from '@Tools/post';
import type { Post } from '@Models/GeneralTypes';

const allPosts = await Astro.glob<Post>('../**/*.md');
const sortedPosts = sortPostByDate(allPosts);
const groupByYearPosts = groupPostByYear(sortedPosts);
const sortYears = Object.keys(groupByYearPosts).sort(
  (a, b) => Number(b) - Number(a)
);
---

<Html title="普通文組 2.0" description="tzyn blog v2 index">
  {
    sortYears.map((year) => (
      <div class="year-container">
        <h2>
          {year}（計{groupByYearPosts[year].length}篇）
        </h2>
        <ul class="post-container">
          {groupByYearPosts[year].map((post) => (
            <PostItem post={post} />
          ))}
        </ul>
      </div>
    ))
  }
</Html>

<style scoped>
  .year-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }

  .year-container:not(:last-of-type) {
    margin-bottom: 16px;
  }

  .year-container h2 {
    margin: 0;
  }

  .post-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
</style>
