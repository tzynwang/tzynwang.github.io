---
import Html from '@Components/layout/Html.astro';
import PostItem from '@Components/element/PostItem.astro';
import { sortPostByDate } from '@Tools/post';
import type { Post } from '@Models/GeneralTypes';

export async function getStaticPaths() {
  const allPosts = await Astro.glob<Post>('../**/*.md');
  const allTags = sortPostByDate(allPosts)
    .map((post) => post.frontmatter.tag)
    .flat(2)
    .sort();
  return allTags.map((tag) => ({ params: { tag } }));
}

const { tag } = Astro.params;

const allPosts = await Astro.glob<Post>('../**/*.md');
const sortedPosts = sortPostByDate(allPosts);
const posts = sortedPosts.filter((post) =>
  post.frontmatter.tag.flat().includes(tag || '')
);
---

<Html>
  <ul class="post-container">
    {posts.map((post) => <PostItem post={post} />)}
  </ul>
</Html>

<style scoped>
  .post-container {
    display: flex;
    flex-direction: column;
    gap: 16px;
  }
</style>
