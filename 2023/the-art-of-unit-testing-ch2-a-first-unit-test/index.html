<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BScVxmeO.js"></script><!-- Google Tag Manager --><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', ga4Id);
    })();</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KM9SGJLK">(function(){const gTagId = "GTM-KM9SGJLK";
})();</script><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', ga4Id);
    })();</script><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🦊</text></svg>"><link rel="sitemap" href="/sitemap-index.xml"><meta name="generator" content="Astro v5.1.2"><!-- Primary Meta Tags --><title>閱讀筆記：The Art of Unit Testing Chapter 2 A first unit test</title><meta name="title" content="閱讀筆記：The Art of Unit Testing Chapter 2 A first unit test"><meta name="description" content="此為 The Art of Unit Testing 第二章的閱讀筆記。此章介紹了測試框架 Jest 與撰寫單元測試的架構、命名技巧。也說明濫用 .beforeEach() 的副作用，以及如何透過工廠模式（factory method）來避免在 .beforeEach() 塞入太多設定的問題。"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test"><meta property="og:title" content="閱讀筆記：The Art of Unit Testing Chapter 2 A first unit test"><meta property="og:description" content="此為 The Art of Unit Testing 第二章的閱讀筆記。此章介紹了測試框架 Jest 與撰寫單元測試的架構、命名技巧。也說明濫用 .beforeEach() 的副作用，以及如何透過工廠模式（factory method）來避免在 .beforeEach() 塞入太多設定的問題。"><meta property="og:image" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test/towfiqu-barbhuiya-J6g_szOtMF4-unsplash.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test"><meta property="twitter:title" content="閱讀筆記：The Art of Unit Testing Chapter 2 A first unit test"><meta property="twitter:description" content="此為 The Art of Unit Testing 第二章的閱讀筆記。此章介紹了測試框架 Jest 與撰寫單元測試的架構、命名技巧。也說明濫用 .beforeEach() 的副作用，以及如何透過工廠模式（factory method）來避免在 .beforeEach() 塞入太多設定的問題。"><meta property="twitter:image" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test/towfiqu-barbhuiya-J6g_szOtMF4-unsplash.jpg"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet"><style>.tag[data-astro-cid-2iymvi75]{position:relative;display:inline-flex;align-items:center;padding:2px 8px;font-size:14px;font-weight:400;text-decoration:none;background-color:#8aa6a3;color:#fff;transition:background-color .2s ease-in-out}.tag[data-astro-cid-2iymvi75]:not(:last-of-type){margin-right:8px}.tag[data-astro-cid-2iymvi75]:hover{background-color:#127369}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}.footer[data-astro-cid-qlgq3onj]{padding:36px;text-align:center}.bottom[data-astro-cid-qlgq3onj]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.side-content[data-astro-cid-75hifxor],.main-content[data-astro-cid-75hifxor]{margin:24px}nav[data-astro-cid-75hifxor]{display:flex;gap:16px}@media screen and (min-width: 800px){body{height:100vh;display:flex;flex-direction:row;overflow-y:hidden}nav[data-astro-cid-75hifxor]{flex-direction:column}.side-content[data-astro-cid-75hifxor]{flex:0 0 240px}.main-content[data-astro-cid-75hifxor]{margin:0;padding:40px 24px 0;flex:1 1 auto;overflow-y:auto;position:relative}}*{margin:0;padding:0;box-sizing:content-box;font-family:sans-serif;text-wrap:pretty;color:#000000e6}html{background-color:#bfbfbf66}a{color:#127369;font-weight:700;text-decoration:underline;text-decoration-color:transparent;transition:text-decoration-color .2s ease-in-out}a:hover{text-decoration-color:#127369}a.link-out{position:absolute;inset:0}ul,li{list-style-position:inside}ul:not(:has(li)){margin-top:16px;margin-bottom:16px}li{margin-top:4px;margin-bottom:4px;line-height:24px}li li{padding-left:16px}img{display:block;max-width:100%}h1,h2{font-size:28px;line-height:42px;margin:16px 0;color:#4c5958}h3,h4{font-size:22px;line-height:34px;margin:16px 0;color:#4c5958}h5{font-size:18px;line-height:28px;margin:4px 0;color:#4c5958}p{font-size:16px;line-height:24px;margin:16px 0}p code{font-size:14px}blockquote{padding-left:16px;border-left:4px solid #4c5958}blockquote *{font-family:Noto Sans,sans-serif}pre{padding:8px 16px}code,code span{font-family:monospace}hr{width:100%;height:1px;margin:16px 0;background-color:#4c5958}del{color:#4c5958e6}ol>li:has(p)>p{display:inline;margin:0}
.post-container[data-astro-cid-qtokga5y] h1[data-astro-cid-qtokga5y]{margin:0 0 16px}.info[data-astro-cid-qtokga5y]{display:flex;flex-direction:column;gap:8px}.toc-container[data-astro-cid-qtokga5y]{margin-bottom:0}.toc-container[data-astro-cid-qtokga5y]>li[data-astro-cid-qtokga5y]:not(:last-of-type){margin-bottom:4px}.toc-2[data-astro-cid-qtokga5y]{margin-left:1rem}.toc-3[data-astro-cid-qtokga5y]{margin-left:2rem}.toc-4[data-astro-cid-qtokga5y]{margin-left:3rem}.toc-5[data-astro-cid-qtokga5y]{margin-left:4rem}@media screen and (min-width: 800px){.post-container[data-astro-cid-qtokga5y]{max-width:600px}}@media screen and (min-width: 1200px){.post-container[data-astro-cid-qtokga5y]{max-width:720px}}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KM9SGJLK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <section class="side-content" data-astro-cid-75hifxor> <h1 data-astro-cid-75hifxor>普通文組 2.0</h1> <nav data-astro-cid-75hifxor> <a href="/" data-astro-cid-75hifxor>首頁</a> <a href="/archive" data-astro-cid-75hifxor>全文章歸檔</a> <a href="/tag" data-astro-cid-75hifxor>以標籤檢視</a> <a href="/rss.xml" data-astro-cid-75hifxor>RSS</a> </nav> </section> <section class="main-content" data-astro-cid-75hifxor>   <div class="post-container" data-astro-cid-qtokga5y> <h1 data-astro-cid-qtokga5y>閱讀筆記：The Art of Unit Testing Chapter 2 A first unit test</h1> <div class="info" data-astro-cid-qtokga5y> <span data-astro-cid-qtokga5y>2023-12-17 13:03</span> <span data-astro-cid-qtokga5y><a class="tag" href="/tag/Testing" data-astro-cid-2iymvi75> Testing </a> </span> <ul class="toc-container" data-astro-cid-qtokga5y> <li class="toc-2" data-astro-cid-qtokga5y> <a href="#筆記總結" data-astro-cid-qtokga5y>筆記總結</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#21-about-jest" data-astro-cid-qtokga5y>2.1 About Jest</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#22-the-library-the-assert-the-runner--the-reporter" data-astro-cid-qtokga5y>2.2 The Library, the Assert, the Runner &amp; the Reporter</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#23-what-unit-testing-frameworks-offer" data-astro-cid-qtokga5y>2.3 What unit testing frameworks offer</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#24-introducing-the-password-verifier-project" data-astro-cid-qtokga5y>2.4 Introducing the Password Verifier Project</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#25-the-first-jest-test-for-verifypassword" data-astro-cid-qtokga5y>2.5 The first Jest test for verifyPassword</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#251-the-arrange-act-assert-aaa-structure" data-astro-cid-qtokga5y>2.5.1 The Arrange-Act-Assert (AAA) structure</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#252-testing-the-test" data-astro-cid-qtokga5y>2.5.2 Testing the test</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#253-use-naming-pattern" data-astro-cid-qtokga5y>2.5.3 U.S.E naming pattern</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#254-string-comparisons-and-maintainability" data-astro-cid-qtokga5y>2.5.4 String comparisons and maintainability</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#255-using-describe" data-astro-cid-qtokga5y>2.5.5 Using describe()</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#256-structure-can-imply-context" data-astro-cid-qtokga5y>2.5.6 Structure can imply context</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#257-the-it-function" data-astro-cid-qtokga5y>2.5.7 The it() function</a> </li><li class="toc-4" data-astro-cid-qtokga5y> <a href="#bdd-behavior-driven-development" data-astro-cid-qtokga5y>BDD (behavior-driven development)</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#258-two-jest-flavors" data-astro-cid-qtokga5y>2.5.8 Two Jest Flavors</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#259-refactoring-the-production-code" data-astro-cid-qtokga5y>2.5.9 Refactoring the Production Code</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#26-trying-the-beforeeach-route" data-astro-cid-qtokga5y>2.6 Trying the beforeEach() route</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#261-beforeeach-and-scroll-fatigue" data-astro-cid-qtokga5y>2.6.1 beforeEach() and scroll fatigue</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#27-trying-the-factory-method-route" data-astro-cid-qtokga5y>2.7 Trying the factory method route</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#28-going-full-circle-to-test" data-astro-cid-qtokga5y>2.8 Going Full Circle to test()</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#29-refactoring-to-parameterized-tests" data-astro-cid-qtokga5y>2.9 Refactoring to parameterized tests</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#210-checking-for-expected-thrown-errors" data-astro-cid-qtokga5y>2.10 Checking for expected thrown errors</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#避免使用-tomatchsnapshot" data-astro-cid-qtokga5y>避免使用 .toMatchSnapshot()</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#211-setting-test-categories" data-astro-cid-qtokga5y>2.11 Setting Test Categories</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#參考文件" data-astro-cid-qtokga5y>參考文件</a> </li> </ul> </div> <h2 id="筆記總結">筆記總結</h2>
<p>第二章介紹了測試框架 Jest 與撰寫單元測試的架構、命名技巧。也說明濫用 <code>.beforeEach()</code> 的副作用，以及如何透過工廠模式（factory method）來避免 <code>.beforeEach()</code> 的<del>快龍</del>肥大問題。</p>
<p><img src="/2023/the-art-of-unit-testing-ch2-a-first-unit-test/肥大出飾拳.jpeg" alt="肥大 出 飾拳"></p>
<h2 id="21-about-jest">2.1 About Jest</h2>
<h2 id="22-the-library-the-assert-the-runner--the-reporter">2.2 The Library, the Assert, the Runner &#x26; the Reporter</h2>
<p>Jest 實際上包含四種與測試有關的功能：</p>
<ol>
<li>提供執行測試的 api (<code>describe</code>, <code>test</code>, <code>it</code>)</li>
<li>提供比對結果的 api (<code>expect</code>)</li>
<li>執行單元測試（a test runner）</li>
<li>提供測試結果（a test reporter）</li>
</ol>
<h2 id="23-what-unit-testing-frameworks-offer">2.3 What unit testing frameworks offer</h2>
<p>相較於自己開發「負責執行測試的功能」，使用框架有以下好處：</p>
<ol>
<li>框架提供 api 與說明文件，讓所有人都知道如何撰寫、修改測試</li>
<li>測試失敗時，主動提供錯誤棧（error stack）</li>
<li>反覆執行、設定自動執行的成本很低——這會讓工程師更願意執行測試</li>
<li>省去維護自架工具的時間，讓工程師把時間拿去為每一個單元寫測試</li>
</ol>
<p><img src="/2023/the-art-of-unit-testing-ch2-a-first-unit-test/what-unit-test-framework-do-for-developer.jpg" alt="what unit test framework do for developer"></p>
<p>提醒：使用測試框架並不代表你會自動寫出好讀、好維護或有意義的測試。</p>
<h2 id="24-introducing-the-password-verifier-project">2.4 Introducing the Password Verifier Project</h2>
<p>以下是我們要為之撰寫單元測試的功能：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rules</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">result.passed) {</span></span>
<span class="line"><span style="color:#E1E4E8">      errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`error ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">reason</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="25-the-first-jest-test-for-verifypassword">2.5 The first Jest test for verifyPassword</h2>
<h3 id="251-the-arrange-act-assert-aaa-structure">2.5.1 The Arrange-Act-Assert (AAA) structure</h3>
<p>指「先安排（arrange）環境，再執行（act）功能，最後驗證（assert）結果」的測試架構。此架構能讓工程師輕鬆理解一個測試的情境與目的。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'badly named test'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // arrange part</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // act part</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // assert part</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toMatch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="252-testing-the-test">2.5.2 Testing the test</h3>
<p>如果把 <code>errors.push()</code> 這行註解掉，測試就會失敗——這證明該測試確實能檢驗一個單元的功能是否正常。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rules</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">result.passed) {</span></span>
<span class="line"><span style="color:#6A737D">      // errors.push(`error ${result.reason}`);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="253-use-naming-pattern">2.5.3 U.S.E naming pattern</h3>
<p>好理解的單元測試名稱應包含以下三種要素：</p>
<ol>
<li>測試哪一個單元（unit）？請指出該單元的名稱</li>
<li>測試情境（scenario）是什麼？</li>
<li>預期結果（expected behavior）是什麼？</li>
</ol>
<p>這樣做的好處是：當測試失敗時，終端提供的會是失敗的測試名稱。命名包含 USE 三要素可以讓工程師馬上知道「哪個單元」在「什麼情境」的測試沒過。</p>
<p>調整名稱後的單元測試如下：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// unit</span></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword, given a failing rule, returns errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // scenario</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#6A737D">  // expected behavior</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="254-string-comparisons-and-maintainability">2.5.4 String comparisons and maintainability</h3>
<p>文字是一種介面：它有可視、會隨著版面變形（換行）的特性。測試文字時，盡量使用彈性較高的比對 api 來確認核心內容是否有出現——比如 <code>.toContain()</code> / <code>.toMatch()</code>——避免少量的非重點內容更動都需要調整單元測試。</p>
<h3 id="255-using-describe">2.5.5 Using describe()</h3>
<p>讓 <code>describe()</code> 描述被測試的單元（unit），讓 <code>test()</code> 描述情境（scenario）與預期結果（expected behavior）：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'given a failing rule, returns errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="256-structure-can-imply-context">2.5.6 Structure can imply context</h3>
<p><code>describe()</code> 支援巢狀結構，所以還能進一步將單元測試的情境（scenario）也收納到 <code>describe()</code> 中：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // arrange, scenario</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#B392F0">    test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'returns errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#6A737D">      // assert, expected behavior</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>如果一個單元有多個退出點（exit point），每一個退出點都該要有一個位於第二層 <code>describe()</code> 的測試。</p>
<h3 id="257-the-it-function">2.5.7 The it() function</h3>
<p><code>it()</code> 與 <code>test()</code> 在 Jest 中是等價功能。硬要說的話—— <code>it()</code> 會讓測試讀起來比較自然。將本書章節 2.5.6 測試中的 <code>test()</code> 以 <code>it()</code> 取代後，會增加一點 BDD (behavior-driven development) 風味：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'returns errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h4 id="bdd-behavior-driven-development">BDD (behavior-driven development)</h4>
<ul>
<li>一種軟體設計方法論，鼓勵開發人員與產品經理、使用者等非技術人員合作</li>
<li>透過使用者故事（user story）與範例（example）來描述軟體行為</li>
</ul>
<h3 id="258-two-jest-flavors">2.5.8 Two Jest Flavors</h3>
<p><code>test()</code> 與 <code>it()</code> 的差異主要是「單元測試讀起來的風格有所不同」。以 <code>it()</code> 開頭會讓測試讀起來更有「是人類在描述功能」的感受。</p>
<h3 id="259-refactoring-the-production-code">2.5.9 Refactoring the Production Code</h3>
<p>如果我們將章節 2.5 的 <code>verifyPassword</code> 重構為物件導向風味的程式碼：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  addRule</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(rule);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  verify</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.passed </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(result.reason);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>會發現第二版的進入點（entry point）變成 <code>addRule()</code>、退出點（exit point）在 <code>verify()</code>——相較於第一版的 <code>verifyPassword</code> 其進入點與退出點都在同一個地方。</p>
<p>而第二版的單元測試會變成這樣：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>看起來沒什麼問題。</p>
<p>但如果我們想把「驗證錯誤訊息內容」「驗證 <code>errors</code> 陣列長度」拆為兩個單元測試的話，會發現一堆重複的內容（<code>verifier</code> / <code>fakeRule</code> / <code>addRule</code>）：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has exactly one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>這時候可以透過 <code>beforeEach()</code> 抽出共用的部分。</p>
<h2 id="26-trying-the-beforeeach-route">2.6 Trying the beforeEach() route</h2>
<p>根據<a href="https://jestjs.io/docs/api#beforeeachfn-timeout">官方文件</a>說明，在 <code>describe()</code> 中的 <code>beforeEach()</code> 會在每一個測試執行前被執行：</p>
<blockquote>
<p>Runs a function <strong>before each of the tests</strong> in this file runs. If <code>beforeEach</code> is inside a <code>describe</code> block, it <strong>runs for each test in the describe block</strong>.</p>
</blockquote>
<p>而每次測試前都要建立的 <code>verifier</code> 實例、透過 <code>.addRule()</code> 注入規則——這些重複的佈局（arrange）工作可以移到 <code>beforeEach()</code> 中：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // arrange</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> verifier, fakeRule;</span></span>
<span class="line"><span style="color:#B392F0">    beforeEach</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">      fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has exactly one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>但重點來了——須知 Jest 的預設是同時執行多個測試，所以共用狀態（上方的 <code>verified</code>）可能會被意外覆蓋。</p>
<p>第一種解決辦法是在 cli 傳入 <code>-i</code> 選項來線性地進行測試（<a href="https://jestjs.io/docs/cli#--runinband">文件在此</a>）。第二種是透過 2.7 會提到的工廠模式（factory method）來避免使用 <code>beforeEach()</code>。</p>
<h3 id="261-beforeeach-and-scroll-fatigue">2.6.1 beforeEach() and scroll fatigue</h3>
<p>除了狀態有可能被意外污染之外，把 arrange 放到 <code>beforeEach()</code> 也會導致工程師「沒辦法只看 <code>it()</code> 就知道這個測試的全貌」。一旦單元 <code>PasswordVerifier</code> 的測試越來越多，工程師必須來回捲動滑鼠才能理解整份測試——本書作者稱之為<strong>捲動疲勞</strong>（scroll fatigue）。</p>
<p>另外，<code>beforeEach()</code> 會在日積月累下變成垃圾桶。工程師會把所有被共享的設定一股腦塞到這裡，也不管這些東西是真的被每一個測試依賴、還是只有部分測試會用到。設定越塞越多，接著就有不確定是否能刪掉的廢 code 出現了。</p>
<p>為了避免垃圾結局，請考慮使用接下來要介紹的工廠模式（factory mode）來取代 <code>beforeEach()</code>。</p>
<h2 id="27-trying-the-factory-method-route">2.7 Trying the factory method route</h2>
<p>工廠模式說穿了就是把重複性的佈局（arrange）部分抽出、變成獨立功能。比如以下範例的 <code>makeVerifierWithPassingRule</code> 與 <code>makeVerifierWithFailedRule</code>：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> passingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">reason</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: reason });</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has exactly one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a passing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has no errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'with a failing and a passing rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'has one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'error text belongs to failed rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      //assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>使用工廠模式的優點是：就算只看每一個 <code>it()</code> 的內容，也能從幫忙執行佈局的<strong>功能名稱</strong>理解該測試的情境是什麼——這讓我們解決了捲動疲勞（scroll fatigue）的問題。</p>
<p>工程師無法從功能名稱知道「情境如何被安排」，但能理解「執行測試時，對應的情境是什麼」。以後也不需要把設定囤積到 <code>beforeEach()</code> 中。</p>
<h2 id="28-going-full-circle-to-test">2.8 Going Full Circle to test()</h2>
<p>在改用工廠模式來安排測試內容後，其實連 <code>describe()</code> 都可以考慮刪掉，因為每一組 <code>test()</code> 都能說明自己的 Arrange-Act-Assert 與 U.S.E 分別是什麼：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> passingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">reason</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason });</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing rule, has no errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with failed rule, has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with failed rule, has exactly one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing and failing rule, has one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing and failing rule, error text belongs to failed rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="29-refactoring-to-parameterized-tests">2.9 Refactoring to parameterized tests</h2>
<p>假設我們寫了一個帶有參數的功能：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    passed: input.</span><span style="color:#B392F0">toLowerCase</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">!==</span><span style="color:#E1E4E8"> input,</span></span>
<span class="line"><span style="color:#E1E4E8">    reason: </span><span style="color:#9ECBFF">'at least one upper case needed'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<p>並且我們想確認「不管參數的大寫位在一個單字的哪一個位置，該功能都能正確判斷單字是否符合『至少包含一個大寫字元』」的話，單元測試可以有至少三種寫法。</p>
<p>第一種：一個條件就是一組 <code>test()</code>。條件變化少的時候確實可以這樣玩，但之後 <code>oneUpperCaseRule</code> 如果更改了實作規格，就有一堆測試要調整。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'one uppercase rule'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'given no uppercase, it fails'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'given one uppercase, it passes'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'given a different uppercase, it passes'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>第二種：使用 Jest 的 <code>test.each()</code> 一口氣傳入所有情境。相較於第一種測試的撰寫方式，現在少了很多重複的部分。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'one uppercase rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'given no uppercase, it fails'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">  test.</span><span style="color:#B392F0">each</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">])(</span><span style="color:#9ECBFF">'given one uppercase, it passes'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'one uppercase rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  test.</span><span style="color:#B392F0">each</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  ])(</span><span style="color:#9ECBFF">'given %s, %s '</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">expected</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(expected);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>第三種：使用 JavaScript 原生的 <code>Object.entries</code> 來為每一種條件跑測試。</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'one uppercase rule, with vanilla JS for'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> TEST_CASE</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    Abc: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    aBc: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    abc: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#F97583">  for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">input</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">expected</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> Object.</span><span style="color:#B392F0">entries</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">TEST_CASE</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#B392F0">    test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`given ${</span><span style="color:#E1E4E8">input</span><span style="color:#9ECBFF">}, ${</span><span style="color:#E1E4E8">expected</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(expected);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>寫測試的方法有很多種，能顧及維護性與可讀性的就是好辦法。</p>
<h2 id="210-checking-for-expected-thrown-errors">2.10 Checking for expected thrown errors</h2>
<p>拉回 <code>PasswordVerifier1</code> 的例子。假設我們在 <code>verify()</code> 追加了檢查 <code>this.rules</code> 的功能：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  addRule</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(rule);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  verify</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // add this line</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'There are no rules configured'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.passed </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(result.reason);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>當我們想要確認「沒有設定 <code>this.rules</code> 的話，執行 <code>this.verify()</code> 應該拋出錯誤」時，可以使用 Jest 的 <code>.toThrowError()</code> 來檢查是否有拋錯、錯誤訊息是否符合預期：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verify, with no rules, throws exception'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">)).</span><span style="color:#B392F0">toThrowError</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">    /</span><span style="color:#DBEDFF">no rules configured</span><span style="color:#9ECBFF">/</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="避免使用-tomatchsnapshot">避免使用 .toMatchSnapshot()</h3>
<p>使用 <code>.toMatchSnapshot()</code> 無法讓人一眼就看出該測試的預期結果是什麼。如果真的需要為測試保留快照，請考慮使用 <code>.toMatchInlineSnapshot()</code> 明列預期結果：</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'renders correctly'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> tree</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> renderer</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">(&#x3C;</span><span style="color:#79B8FF">Link</span><span style="color:#B392F0"> page</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"https://example.com"</span><span style="color:#E1E4E8">>Example Site&#x3C;/</span><span style="color:#79B8FF">Link</span><span style="color:#E1E4E8">>)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(tree).</span><span style="color:#B392F0">toMatchInlineSnapshot</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;a</span></span>
<span class="line"><span style="color:#9ECBFF">      className="normal"</span></span>
<span class="line"><span style="color:#9ECBFF">      href="https://example.com"</span></span>
<span class="line"><span style="color:#9ECBFF">      onMouseEnter={[Function]}</span></span>
<span class="line"><span style="color:#9ECBFF">      onMouseLeave={[Function]}</span></span>
<span class="line"><span style="color:#9ECBFF">    ></span></span>
<span class="line"><span style="color:#9ECBFF">      Example Site</span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;/a></span></span>
<span class="line"><span style="color:#9ECBFF">  `</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="211-setting-test-categories">2.11 Setting Test Categories</h2>
<p>Jest 目前並不支援「將測試分類，並執行特定類別（例：單元、整合測試）的測試」。不過工程師能透過以下方式達成「依類別跑測試」的需求：</p>
<ol>
<li>讓不同類別的測試有其命名模式或收納資料夾</li>
<li>在 <code>jest.config.js</code> 中透過 <a href="https://jestjs.io/docs/configuration#testregex-string--arraystring">testRegex</a> 或終端指令 <a href="https://jestjs.io/docs/cli#--testpathpatternregex"><code>--testPathPattern=&#x3C;regex></code></a> 來指定執行特定名稱規則的測試</li>
</ol>
<h2 id="參考文件">參考文件</h2>
<ul>
<li><a href="https://www.manning.com/books/the-art-of-unit-testing-third-edition">Manning: The Art of Unit Testing, Third Edition</a></li>
</ul> </div>   <footer class="footer" data-astro-cid-qlgq3onj>
Tzu Yin (Charlie) 🦊 Made in Taiwan
</footer>  </section>  </body></html> 