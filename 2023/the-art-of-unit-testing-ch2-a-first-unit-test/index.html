<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BScVxmeO.js"></script><!-- Google Tag Manager --><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', ga4Id);
    })();</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KM9SGJLK">(function(){const gTagId = "GTM-KM9SGJLK";
})();</script><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', ga4Id);
    })();</script><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦Š</text></svg>"><link rel="sitemap" href="/sitemap-index.xml"><meta name="generator" content="Astro v5.1.2"><!-- Primary Meta Tags --><title>é–±è®€ç­†è¨˜ï¼šThe Art of Unit Testing Chapter 2 A first unit test</title><meta name="title" content="é–±è®€ç­†è¨˜ï¼šThe Art of Unit Testing Chapter 2 A first unit test"><meta name="description" content="æ­¤ç‚º The Art of Unit Testing ç¬¬äºŒç« çš„é–±è®€ç­†è¨˜ã€‚æ­¤ç« ä»‹ç´¹äº†æ¸¬è©¦æ¡†æ¶ Jest èˆ‡æ’°å¯«å–®å…ƒæ¸¬è©¦çš„æ¶æ§‹ã€å‘½åæŠ€å·§ã€‚ä¹Ÿèªªæ˜æ¿«ç”¨ .beforeEach() çš„å‰¯ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•é€éå·¥å» æ¨¡å¼ï¼ˆfactory methodï¼‰ä¾†é¿å…åœ¨ .beforeEach() å¡å…¥å¤ªå¤šè¨­å®šçš„å•é¡Œã€‚"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test"><meta property="og:title" content="é–±è®€ç­†è¨˜ï¼šThe Art of Unit Testing Chapter 2 A first unit test"><meta property="og:description" content="æ­¤ç‚º The Art of Unit Testing ç¬¬äºŒç« çš„é–±è®€ç­†è¨˜ã€‚æ­¤ç« ä»‹ç´¹äº†æ¸¬è©¦æ¡†æ¶ Jest èˆ‡æ’°å¯«å–®å…ƒæ¸¬è©¦çš„æ¶æ§‹ã€å‘½åæŠ€å·§ã€‚ä¹Ÿèªªæ˜æ¿«ç”¨ .beforeEach() çš„å‰¯ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•é€éå·¥å» æ¨¡å¼ï¼ˆfactory methodï¼‰ä¾†é¿å…åœ¨ .beforeEach() å¡å…¥å¤ªå¤šè¨­å®šçš„å•é¡Œã€‚"><meta property="og:image" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test/towfiqu-barbhuiya-J6g_szOtMF4-unsplash.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test"><meta property="twitter:title" content="é–±è®€ç­†è¨˜ï¼šThe Art of Unit Testing Chapter 2 A first unit test"><meta property="twitter:description" content="æ­¤ç‚º The Art of Unit Testing ç¬¬äºŒç« çš„é–±è®€ç­†è¨˜ã€‚æ­¤ç« ä»‹ç´¹äº†æ¸¬è©¦æ¡†æ¶ Jest èˆ‡æ’°å¯«å–®å…ƒæ¸¬è©¦çš„æ¶æ§‹ã€å‘½åæŠ€å·§ã€‚ä¹Ÿèªªæ˜æ¿«ç”¨ .beforeEach() çš„å‰¯ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•é€éå·¥å» æ¨¡å¼ï¼ˆfactory methodï¼‰ä¾†é¿å…åœ¨ .beforeEach() å¡å…¥å¤ªå¤šè¨­å®šçš„å•é¡Œã€‚"><meta property="twitter:image" content="https://tzynwang.github.io/2023/the-art-of-unit-testing-ch2-a-first-unit-test/towfiqu-barbhuiya-J6g_szOtMF4-unsplash.jpg"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet"><style>.tag[data-astro-cid-2iymvi75]{position:relative;display:inline-flex;align-items:center;padding:2px 8px;font-size:14px;font-weight:400;text-decoration:none;background-color:#8aa6a3;color:#fff;transition:background-color .2s ease-in-out}.tag[data-astro-cid-2iymvi75]:not(:last-of-type){margin-right:8px}.tag[data-astro-cid-2iymvi75]:hover{background-color:#127369}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}.footer[data-astro-cid-qlgq3onj]{padding:36px;text-align:center}.bottom[data-astro-cid-qlgq3onj]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.side-content[data-astro-cid-75hifxor],.main-content[data-astro-cid-75hifxor]{margin:24px}nav[data-astro-cid-75hifxor]{display:flex;gap:16px}@media screen and (min-width: 800px){body{height:100vh;display:flex;flex-direction:row;overflow-y:hidden}nav[data-astro-cid-75hifxor]{flex-direction:column}.side-content[data-astro-cid-75hifxor]{flex:0 0 240px}.main-content[data-astro-cid-75hifxor]{margin:0;padding:40px 24px 0;flex:1 1 auto;overflow-y:auto;position:relative}}*{margin:0;padding:0;box-sizing:content-box;font-family:sans-serif;text-wrap:pretty;color:#000000e6}html{background-color:#bfbfbf66}a{color:#127369;font-weight:700;text-decoration:underline;text-decoration-color:transparent;transition:text-decoration-color .2s ease-in-out}a:hover{text-decoration-color:#127369}a.link-out{position:absolute;inset:0}ul,li{list-style-position:inside}ul:not(:has(li)){margin-top:16px;margin-bottom:16px}li{margin-top:4px;margin-bottom:4px;line-height:24px}li li{padding-left:16px}img{display:block;max-width:100%}h1,h2{font-size:28px;line-height:42px;margin:16px 0;color:#4c5958}h3,h4{font-size:22px;line-height:34px;margin:16px 0;color:#4c5958}h5{font-size:18px;line-height:28px;margin:4px 0;color:#4c5958}p{font-size:16px;line-height:24px;margin:16px 0}p code{font-size:14px}blockquote{padding-left:16px;border-left:4px solid #4c5958}blockquote *{font-family:Noto Sans,sans-serif}pre{padding:8px 16px}code,code span{font-family:monospace}hr{width:100%;height:1px;margin:16px 0;background-color:#4c5958}del{color:#4c5958e6}ol>li:has(p)>p{display:inline;margin:0}
.post-container[data-astro-cid-qtokga5y] h1[data-astro-cid-qtokga5y]{margin:0 0 16px}.info[data-astro-cid-qtokga5y]{display:flex;flex-direction:column;gap:8px}.toc-container[data-astro-cid-qtokga5y]{margin-bottom:0}.toc-container[data-astro-cid-qtokga5y]>li[data-astro-cid-qtokga5y]:not(:last-of-type){margin-bottom:4px}.toc-2[data-astro-cid-qtokga5y]{margin-left:1rem}.toc-3[data-astro-cid-qtokga5y]{margin-left:2rem}.toc-4[data-astro-cid-qtokga5y]{margin-left:3rem}.toc-5[data-astro-cid-qtokga5y]{margin-left:4rem}@media screen and (min-width: 800px){.post-container[data-astro-cid-qtokga5y]{max-width:600px}}@media screen and (min-width: 1200px){.post-container[data-astro-cid-qtokga5y]{max-width:720px}}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KM9SGJLK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <section class="side-content" data-astro-cid-75hifxor> <h1 data-astro-cid-75hifxor>æ™®é€šæ–‡çµ„ 2.0</h1> <nav data-astro-cid-75hifxor> <a href="/" data-astro-cid-75hifxor>é¦–é </a> <a href="/archive" data-astro-cid-75hifxor>å…¨æ–‡ç« æ­¸æª”</a> <a href="/tag" data-astro-cid-75hifxor>ä»¥æ¨™ç±¤æª¢è¦–</a> <a href="/rss.xml" data-astro-cid-75hifxor>RSS</a> </nav> </section> <section class="main-content" data-astro-cid-75hifxor>   <div class="post-container" data-astro-cid-qtokga5y> <h1 data-astro-cid-qtokga5y>é–±è®€ç­†è¨˜ï¼šThe Art of Unit Testing Chapter 2 A first unit test</h1> <div class="info" data-astro-cid-qtokga5y> <span data-astro-cid-qtokga5y>2023-12-17 13:03</span> <span data-astro-cid-qtokga5y><a class="tag" href="/tag/Testing" data-astro-cid-2iymvi75> Testing </a> </span> <ul class="toc-container" data-astro-cid-qtokga5y> <li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç­†è¨˜ç¸½çµ" data-astro-cid-qtokga5y>ç­†è¨˜ç¸½çµ</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#21-about-jest" data-astro-cid-qtokga5y>2.1 About Jest</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#22-the-library-the-assert-the-runner--the-reporter" data-astro-cid-qtokga5y>2.2 The Library, the Assert, the Runner &amp; the Reporter</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#23-what-unit-testing-frameworks-offer" data-astro-cid-qtokga5y>2.3 What unit testing frameworks offer</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#24-introducing-the-password-verifier-project" data-astro-cid-qtokga5y>2.4 Introducing the Password Verifier Project</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#25-the-first-jest-test-for-verifypassword" data-astro-cid-qtokga5y>2.5 The first Jest test for verifyPassword</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#251-the-arrange-act-assert-aaa-structure" data-astro-cid-qtokga5y>2.5.1 The Arrange-Act-Assert (AAA) structure</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#252-testing-the-test" data-astro-cid-qtokga5y>2.5.2 Testing the test</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#253-use-naming-pattern" data-astro-cid-qtokga5y>2.5.3 U.S.E naming pattern</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#254-string-comparisons-and-maintainability" data-astro-cid-qtokga5y>2.5.4 String comparisons and maintainability</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#255-using-describe" data-astro-cid-qtokga5y>2.5.5 Using describe()</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#256-structure-can-imply-context" data-astro-cid-qtokga5y>2.5.6 Structure can imply context</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#257-the-it-function" data-astro-cid-qtokga5y>2.5.7 The it() function</a> </li><li class="toc-4" data-astro-cid-qtokga5y> <a href="#bdd-behavior-driven-development" data-astro-cid-qtokga5y>BDD (behavior-driven development)</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#258-two-jest-flavors" data-astro-cid-qtokga5y>2.5.8 Two Jest Flavors</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#259-refactoring-the-production-code" data-astro-cid-qtokga5y>2.5.9 Refactoring the Production Code</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#26-trying-the-beforeeach-route" data-astro-cid-qtokga5y>2.6 Trying the beforeEach() route</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#261-beforeeach-and-scroll-fatigue" data-astro-cid-qtokga5y>2.6.1 beforeEach() and scroll fatigue</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#27-trying-the-factory-method-route" data-astro-cid-qtokga5y>2.7 Trying the factory method route</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#28-going-full-circle-to-test" data-astro-cid-qtokga5y>2.8 Going Full Circle to test()</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#29-refactoring-to-parameterized-tests" data-astro-cid-qtokga5y>2.9 Refactoring to parameterized tests</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#210-checking-for-expected-thrown-errors" data-astro-cid-qtokga5y>2.10 Checking for expected thrown errors</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#é¿å…ä½¿ç”¨-tomatchsnapshot" data-astro-cid-qtokga5y>é¿å…ä½¿ç”¨ .toMatchSnapshot()</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#211-setting-test-categories" data-astro-cid-qtokga5y>2.11 Setting Test Categories</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#åƒè€ƒæ–‡ä»¶" data-astro-cid-qtokga5y>åƒè€ƒæ–‡ä»¶</a> </li> </ul> </div> <h2 id="ç­†è¨˜ç¸½çµ">ç­†è¨˜ç¸½çµ</h2>
<p>ç¬¬äºŒç« ä»‹ç´¹äº†æ¸¬è©¦æ¡†æ¶ Jest èˆ‡æ’°å¯«å–®å…ƒæ¸¬è©¦çš„æ¶æ§‹ã€å‘½åæŠ€å·§ã€‚ä¹Ÿèªªæ˜æ¿«ç”¨ <code>.beforeEach()</code> çš„å‰¯ä½œç”¨ï¼Œä»¥åŠå¦‚ä½•é€éå·¥å» æ¨¡å¼ï¼ˆfactory methodï¼‰ä¾†é¿å… <code>.beforeEach()</code> çš„<del>å¿«é¾</del>è‚¥å¤§å•é¡Œã€‚</p>
<p><img src="/2023/the-art-of-unit-testing-ch2-a-first-unit-test/è‚¥å¤§å‡ºé£¾æ‹³.jpeg" alt="è‚¥å¤§ å‡º é£¾æ‹³"></p>
<h2 id="21-about-jest">2.1 About Jest</h2>
<h2 id="22-the-library-the-assert-the-runner--the-reporter">2.2 The Library, the Assert, the Runner &#x26; the Reporter</h2>
<p>Jest å¯¦éš›ä¸ŠåŒ…å«å››ç¨®èˆ‡æ¸¬è©¦æœ‰é—œçš„åŠŸèƒ½ï¼š</p>
<ol>
<li>æä¾›åŸ·è¡Œæ¸¬è©¦çš„ api (<code>describe</code>, <code>test</code>, <code>it</code>)</li>
<li>æä¾›æ¯”å°çµæœçš„ api (<code>expect</code>)</li>
<li>åŸ·è¡Œå–®å…ƒæ¸¬è©¦ï¼ˆa test runnerï¼‰</li>
<li>æä¾›æ¸¬è©¦çµæœï¼ˆa test reporterï¼‰</li>
</ol>
<h2 id="23-what-unit-testing-frameworks-offer">2.3 What unit testing frameworks offer</h2>
<p>ç›¸è¼ƒæ–¼è‡ªå·±é–‹ç™¼ã€Œè² è²¬åŸ·è¡Œæ¸¬è©¦çš„åŠŸèƒ½ã€ï¼Œä½¿ç”¨æ¡†æ¶æœ‰ä»¥ä¸‹å¥½è™•ï¼š</p>
<ol>
<li>æ¡†æ¶æä¾› api èˆ‡èªªæ˜æ–‡ä»¶ï¼Œè®“æ‰€æœ‰äººéƒ½çŸ¥é“å¦‚ä½•æ’°å¯«ã€ä¿®æ”¹æ¸¬è©¦</li>
<li>æ¸¬è©¦å¤±æ•—æ™‚ï¼Œä¸»å‹•æä¾›éŒ¯èª¤æ£§ï¼ˆerror stackï¼‰</li>
<li>åè¦†åŸ·è¡Œã€è¨­å®šè‡ªå‹•åŸ·è¡Œçš„æˆæœ¬å¾ˆä½â€”â€”é€™æœƒè®“å·¥ç¨‹å¸«æ›´é¡˜æ„åŸ·è¡Œæ¸¬è©¦</li>
<li>çœå»ç¶­è­·è‡ªæ¶å·¥å…·çš„æ™‚é–“ï¼Œè®“å·¥ç¨‹å¸«æŠŠæ™‚é–“æ‹¿å»ç‚ºæ¯ä¸€å€‹å–®å…ƒå¯«æ¸¬è©¦</li>
</ol>
<p><img src="/2023/the-art-of-unit-testing-ch2-a-first-unit-test/what-unit-test-framework-do-for-developer.jpg" alt="what unit test framework do for developer"></p>
<p>æé†’ï¼šä½¿ç”¨æ¸¬è©¦æ¡†æ¶ä¸¦ä¸ä»£è¡¨ä½ æœƒè‡ªå‹•å¯«å‡ºå¥½è®€ã€å¥½ç¶­è­·æˆ–æœ‰æ„ç¾©çš„æ¸¬è©¦ã€‚</p>
<h2 id="24-introducing-the-password-verifier-project">2.4 Introducing the Password Verifier Project</h2>
<p>ä»¥ä¸‹æ˜¯æˆ‘å€‘è¦ç‚ºä¹‹æ’°å¯«å–®å…ƒæ¸¬è©¦çš„åŠŸèƒ½ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rules</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">result.passed) {</span></span>
<span class="line"><span style="color:#E1E4E8">      errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`error ${</span><span style="color:#E1E4E8">result</span><span style="color:#9ECBFF">.</span><span style="color:#E1E4E8">reason</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h2 id="25-the-first-jest-test-for-verifypassword">2.5 The first Jest test for verifyPassword</h2>
<h3 id="251-the-arrange-act-assert-aaa-structure">2.5.1 The Arrange-Act-Assert (AAA) structure</h3>
<p>æŒ‡ã€Œå…ˆå®‰æ’ï¼ˆarrangeï¼‰ç’°å¢ƒï¼Œå†åŸ·è¡Œï¼ˆactï¼‰åŠŸèƒ½ï¼Œæœ€å¾Œé©—è­‰ï¼ˆassertï¼‰çµæœã€çš„æ¸¬è©¦æ¶æ§‹ã€‚æ­¤æ¶æ§‹èƒ½è®“å·¥ç¨‹å¸«è¼•é¬†ç†è§£ä¸€å€‹æ¸¬è©¦çš„æƒ…å¢ƒèˆ‡ç›®çš„ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'badly named test'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // arrange part</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // act part</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#6A737D">  // assert part</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toMatch</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="252-testing-the-test">2.5.2 Testing the test</h3>
<p>å¦‚æœæŠŠ <code>errors.push()</code> é€™è¡Œè¨»è§£æ‰ï¼Œæ¸¬è©¦å°±æœƒå¤±æ•—â€”â€”é€™è­‰æ˜è©²æ¸¬è©¦ç¢ºå¯¦èƒ½æª¢é©—ä¸€å€‹å–®å…ƒçš„åŠŸèƒ½æ˜¯å¦æ­£å¸¸ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">function</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">rules</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8">  rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#E1E4E8">result.passed) {</span></span>
<span class="line"><span style="color:#6A737D">      // errors.push(`error ${result.reason}`);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<h3 id="253-use-naming-pattern">2.5.3 U.S.E naming pattern</h3>
<p>å¥½ç†è§£çš„å–®å…ƒæ¸¬è©¦åç¨±æ‡‰åŒ…å«ä»¥ä¸‹ä¸‰ç¨®è¦ç´ ï¼š</p>
<ol>
<li>æ¸¬è©¦å“ªä¸€å€‹å–®å…ƒï¼ˆunitï¼‰ï¼Ÿè«‹æŒ‡å‡ºè©²å–®å…ƒçš„åç¨±</li>
<li>æ¸¬è©¦æƒ…å¢ƒï¼ˆscenarioï¼‰æ˜¯ä»€éº¼ï¼Ÿ</li>
<li>é æœŸçµæœï¼ˆexpected behaviorï¼‰æ˜¯ä»€éº¼ï¼Ÿ</li>
</ol>
<p>é€™æ¨£åšçš„å¥½è™•æ˜¯ï¼šç•¶æ¸¬è©¦å¤±æ•—æ™‚ï¼Œçµ‚ç«¯æä¾›çš„æœƒæ˜¯å¤±æ•—çš„æ¸¬è©¦åç¨±ã€‚å‘½ååŒ…å« USE ä¸‰è¦ç´ å¯ä»¥è®“å·¥ç¨‹å¸«é¦¬ä¸ŠçŸ¥é“ã€Œå“ªå€‹å–®å…ƒã€åœ¨ã€Œä»€éº¼æƒ…å¢ƒã€çš„æ¸¬è©¦æ²’éã€‚</p>
<p>èª¿æ•´åç¨±å¾Œçš„å–®å…ƒæ¸¬è©¦å¦‚ä¸‹ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#6A737D">// unit</span></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword,Â givenÂ aÂ failingÂ rule,Â returnsÂ errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">  // scenario</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#6A737D">  // expected behavior</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="254-string-comparisons-and-maintainability">2.5.4 String comparisons and maintainability</h3>
<p>æ–‡å­—æ˜¯ä¸€ç¨®ä»‹é¢ï¼šå®ƒæœ‰å¯è¦–ã€æœƒéš¨è‘—ç‰ˆé¢è®Šå½¢ï¼ˆæ›è¡Œï¼‰çš„ç‰¹æ€§ã€‚æ¸¬è©¦æ–‡å­—æ™‚ï¼Œç›¡é‡ä½¿ç”¨å½ˆæ€§è¼ƒé«˜çš„æ¯”å° api ä¾†ç¢ºèªæ ¸å¿ƒå…§å®¹æ˜¯å¦æœ‰å‡ºç¾â€”â€”æ¯”å¦‚ <code>.toContain()</code> / <code>.toMatch()</code>â€”â€”é¿å…å°‘é‡çš„éé‡é»å…§å®¹æ›´å‹•éƒ½éœ€è¦èª¿æ•´å–®å…ƒæ¸¬è©¦ã€‚</p>
<h3 id="255-using-describe">2.5.5 Using describe()</h3>
<p>è®“ <code>describe()</code> æè¿°è¢«æ¸¬è©¦çš„å–®å…ƒï¼ˆunitï¼‰ï¼Œè®“ <code>test()</code> æè¿°æƒ…å¢ƒï¼ˆscenarioï¼‰èˆ‡é æœŸçµæœï¼ˆexpected behaviorï¼‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'givenÂ aÂ failingÂ rule,Â returnsÂ errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="256-structure-can-imply-context">2.5.6 Structure can imply context</h3>
<p><code>describe()</code> æ”¯æ´å·¢ç‹€çµæ§‹ï¼Œæ‰€ä»¥é‚„èƒ½é€²ä¸€æ­¥å°‡å–®å…ƒæ¸¬è©¦çš„æƒ…å¢ƒï¼ˆscenarioï¼‰ä¹Ÿæ”¶ç´åˆ° <code>describe()</code> ä¸­ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // arrange, scenario</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#B392F0">    test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'returnsÂ errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#6A737D">      // assert, expected behavior</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>å¦‚æœä¸€å€‹å–®å…ƒæœ‰å¤šå€‹é€€å‡ºé»ï¼ˆexit pointï¼‰ï¼Œæ¯ä¸€å€‹é€€å‡ºé»éƒ½è©²è¦æœ‰ä¸€å€‹ä½æ–¼ç¬¬äºŒå±¤ <code>describe()</code> çš„æ¸¬è©¦ã€‚</p>
<h3 id="257-the-it-function">2.5.7 The it() function</h3>
<p><code>it()</code> èˆ‡ <code>test()</code> åœ¨ Jest ä¸­æ˜¯ç­‰åƒ¹åŠŸèƒ½ã€‚ç¡¬è¦èªªçš„è©±â€”â€” <code>it()</code> æœƒè®“æ¸¬è©¦è®€èµ·ä¾†æ¯”è¼ƒè‡ªç„¶ã€‚å°‡æœ¬æ›¸ç« ç¯€ 2.5.6 æ¸¬è©¦ä¸­çš„ <code>test()</code> ä»¥ <code>it()</code> å–ä»£å¾Œï¼Œæœƒå¢åŠ ä¸€é» BDD (behavior-driven development) é¢¨å‘³ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verifyPassword'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'returnsÂ errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> verifyPassword</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">, [fakeRule]);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h4 id="bdd-behavior-driven-development">BDD (behavior-driven development)</h4>
<ul>
<li>ä¸€ç¨®è»Ÿé«”è¨­è¨ˆæ–¹æ³•è«–ï¼Œé¼“å‹µé–‹ç™¼äººå“¡èˆ‡ç”¢å“ç¶“ç†ã€ä½¿ç”¨è€…ç­‰éæŠ€è¡“äººå“¡åˆä½œ</li>
<li>é€éä½¿ç”¨è€…æ•…äº‹ï¼ˆuser storyï¼‰èˆ‡ç¯„ä¾‹ï¼ˆexampleï¼‰ä¾†æè¿°è»Ÿé«”è¡Œç‚º</li>
</ul>
<h3 id="258-two-jest-flavors">2.5.8 Two Jest Flavors</h3>
<p><code>test()</code> èˆ‡ <code>it()</code> çš„å·®ç•°ä¸»è¦æ˜¯ã€Œå–®å…ƒæ¸¬è©¦è®€èµ·ä¾†çš„é¢¨æ ¼æœ‰æ‰€ä¸åŒã€ã€‚ä»¥ <code>it()</code> é–‹é ­æœƒè®“æ¸¬è©¦è®€èµ·ä¾†æ›´æœ‰ã€Œæ˜¯äººé¡åœ¨æè¿°åŠŸèƒ½ã€çš„æ„Ÿå—ã€‚</p>
<h3 id="259-refactoring-the-production-code">2.5.9 Refactoring the Production Code</h3>
<p>å¦‚æœæˆ‘å€‘å°‡ç« ç¯€ 2.5 çš„ <code>verifyPassword</code> é‡æ§‹ç‚ºç‰©ä»¶å°å‘é¢¨å‘³çš„ç¨‹å¼ç¢¼ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  addRule</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(rule);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  verify</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.passed </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(result.reason);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>æœƒç™¼ç¾ç¬¬äºŒç‰ˆçš„é€²å…¥é»ï¼ˆentry pointï¼‰è®Šæˆ <code>addRule()</code>ã€é€€å‡ºé»ï¼ˆexit pointï¼‰åœ¨ <code>verify()</code>â€”â€”ç›¸è¼ƒæ–¼ç¬¬ä¸€ç‰ˆçš„ <code>verifyPassword</code> å…¶é€²å…¥é»èˆ‡é€€å‡ºé»éƒ½åœ¨åŒä¸€å€‹åœ°æ–¹ã€‚</p>
<p>è€Œç¬¬äºŒç‰ˆçš„å–®å…ƒæ¸¬è©¦æœƒè®Šæˆé€™æ¨£ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ anÂ errorÂ messageÂ basedÂ onÂ theÂ rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>çœ‹èµ·ä¾†æ²’ä»€éº¼å•é¡Œã€‚</p>
<p>ä½†å¦‚æœæˆ‘å€‘æƒ³æŠŠã€Œé©—è­‰éŒ¯èª¤è¨Šæ¯å…§å®¹ã€ã€Œé©—è­‰ <code>errors</code> é™£åˆ—é•·åº¦ã€æ‹†ç‚ºå…©å€‹å–®å…ƒæ¸¬è©¦çš„è©±ï¼Œæœƒç™¼ç¾ä¸€å †é‡è¤‡çš„å…§å®¹ï¼ˆ<code>verifier</code> / <code>fakeRule</code> / <code>addRule</code>ï¼‰ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ anÂ errorÂ messageÂ basedÂ onÂ theÂ rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ exactlyÂ oneÂ error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>é€™æ™‚å€™å¯ä»¥é€é <code>beforeEach()</code> æŠ½å‡ºå…±ç”¨çš„éƒ¨åˆ†ã€‚</p>
<h2 id="26-trying-the-beforeeach-route">2.6 Trying the beforeEach() route</h2>
<p>æ ¹æ“š<a href="https://jestjs.io/docs/api#beforeeachfn-timeout">å®˜æ–¹æ–‡ä»¶</a>èªªæ˜ï¼Œåœ¨ <code>describe()</code> ä¸­çš„ <code>beforeEach()</code> æœƒåœ¨æ¯ä¸€å€‹æ¸¬è©¦åŸ·è¡Œå‰è¢«åŸ·è¡Œï¼š</p>
<blockquote>
<p>Runs a function <strong>before each of the tests</strong> in this file runs. IfÂ <code>beforeEach</code>Â is inside aÂ <code>describe</code>Â block, it <strong>runs for each test in the describe block</strong>.</p>
</blockquote>
<p>è€Œæ¯æ¬¡æ¸¬è©¦å‰éƒ½è¦å»ºç«‹çš„ <code>verifier</code> å¯¦ä¾‹ã€é€é <code>.addRule()</code> æ³¨å…¥è¦å‰‡â€”â€”é€™äº›é‡è¤‡çš„ä½ˆå±€ï¼ˆarrangeï¼‰å·¥ä½œå¯ä»¥ç§»åˆ° <code>beforeEach()</code> ä¸­ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">    // arrange</span></span>
<span class="line"><span style="color:#F97583">    let</span><span style="color:#E1E4E8"> verifier, fakeRule;</span></span>
<span class="line"><span style="color:#B392F0">    beforeEach</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier </span><span style="color:#F97583">=</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">      fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ anÂ errorÂ messageÂ basedÂ onÂ theÂ rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ exactlyÂ oneÂ error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ value'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>ä½†é‡é»ä¾†äº†â€”â€”é ˆçŸ¥ Jest çš„é è¨­æ˜¯åŒæ™‚åŸ·è¡Œå¤šå€‹æ¸¬è©¦ï¼Œæ‰€ä»¥å…±ç”¨ç‹€æ…‹ï¼ˆä¸Šæ–¹çš„ <code>verified</code>ï¼‰å¯èƒ½æœƒè¢«æ„å¤–è¦†è“‹ã€‚</p>
<p>ç¬¬ä¸€ç¨®è§£æ±ºè¾¦æ³•æ˜¯åœ¨ cli å‚³å…¥ <code>-i</code> é¸é …ä¾†ç·šæ€§åœ°é€²è¡Œæ¸¬è©¦ï¼ˆ<a href="https://jestjs.io/docs/cli#--runinband">æ–‡ä»¶åœ¨æ­¤</a>ï¼‰ã€‚ç¬¬äºŒç¨®æ˜¯é€é 2.7 æœƒæåˆ°çš„å·¥å» æ¨¡å¼ï¼ˆfactory methodï¼‰ä¾†é¿å…ä½¿ç”¨ <code>beforeEach()</code>ã€‚</p>
<h3 id="261-beforeeach-and-scroll-fatigue">2.6.1 beforeEach() and scroll fatigue</h3>
<p>é™¤äº†ç‹€æ…‹æœ‰å¯èƒ½è¢«æ„å¤–æ±¡æŸ“ä¹‹å¤–ï¼ŒæŠŠ arrange æ”¾åˆ° <code>beforeEach()</code> ä¹Ÿæœƒå°è‡´å·¥ç¨‹å¸«ã€Œæ²’è¾¦æ³•åªçœ‹ <code>it()</code> å°±çŸ¥é“é€™å€‹æ¸¬è©¦çš„å…¨è²Œã€ã€‚ä¸€æ—¦å–®å…ƒ <code>PasswordVerifier</code> çš„æ¸¬è©¦è¶Šä¾†è¶Šå¤šï¼Œå·¥ç¨‹å¸«å¿…é ˆä¾†å›æ²å‹•æ»‘é¼ æ‰èƒ½ç†è§£æ•´ä»½æ¸¬è©¦â€”â€”æœ¬æ›¸ä½œè€…ç¨±ä¹‹ç‚º<strong>æ²å‹•ç–²å‹</strong>ï¼ˆscroll fatigueï¼‰ã€‚</p>
<p>å¦å¤–ï¼Œ<code>beforeEach()</code> æœƒåœ¨æ—¥ç©æœˆç´¯ä¸‹è®Šæˆåƒåœ¾æ¡¶ã€‚å·¥ç¨‹å¸«æœƒæŠŠæ‰€æœ‰è¢«å…±äº«çš„è¨­å®šä¸€è‚¡è…¦å¡åˆ°é€™è£¡ï¼Œä¹Ÿä¸ç®¡é€™äº›æ±è¥¿æ˜¯çœŸçš„è¢«æ¯ä¸€å€‹æ¸¬è©¦ä¾è³´ã€é‚„æ˜¯åªæœ‰éƒ¨åˆ†æ¸¬è©¦æœƒç”¨åˆ°ã€‚è¨­å®šè¶Šå¡è¶Šå¤šï¼Œæ¥è‘—å°±æœ‰ä¸ç¢ºå®šæ˜¯å¦èƒ½åˆªæ‰çš„å»¢ code å‡ºç¾äº†ã€‚</p>
<p>ç‚ºäº†é¿å…åƒåœ¾çµå±€ï¼Œè«‹è€ƒæ…®ä½¿ç”¨æ¥ä¸‹ä¾†è¦ä»‹ç´¹çš„å·¥å» æ¨¡å¼ï¼ˆfactory modeï¼‰ä¾†å–ä»£ <code>beforeEach()</code>ã€‚</p>
<h2 id="27-trying-the-factory-method-route">2.7 Trying the factory method route</h2>
<p>å·¥å» æ¨¡å¼èªªç©¿äº†å°±æ˜¯æŠŠé‡è¤‡æ€§çš„ä½ˆå±€ï¼ˆarrangeï¼‰éƒ¨åˆ†æŠ½å‡ºã€è®Šæˆç¨ç«‹åŠŸèƒ½ã€‚æ¯”å¦‚ä»¥ä¸‹ç¯„ä¾‹çš„ <code>makeVerifierWithPassingRule</code> èˆ‡ <code>makeVerifierWithFailedRule</code>ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> passingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">reason</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason: reason });</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'PasswordVerifier'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ anÂ errorÂ messageÂ basedÂ onÂ theÂ rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ exactlyÂ oneÂ error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ passingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ noÂ errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#B392F0">  describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'withÂ aÂ failingÂ andÂ aÂ passingÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'hasÂ oneÂ error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      // assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#B392F0">    it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'errorÂ textÂ belongsÂ toÂ failedÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#6A737D">      // arrange</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">      verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#6A737D">      // act</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#6A737D">      //assert</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fakeÂ reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>ä½¿ç”¨å·¥å» æ¨¡å¼çš„å„ªé»æ˜¯ï¼šå°±ç®—åªçœ‹æ¯ä¸€å€‹ <code>it()</code> çš„å…§å®¹ï¼Œä¹Ÿèƒ½å¾å¹«å¿™åŸ·è¡Œä½ˆå±€çš„<strong>åŠŸèƒ½åç¨±</strong>ç†è§£è©²æ¸¬è©¦çš„æƒ…å¢ƒæ˜¯ä»€éº¼â€”â€”é€™è®“æˆ‘å€‘è§£æ±ºäº†æ²å‹•ç–²å‹ï¼ˆscroll fatigueï¼‰çš„å•é¡Œã€‚</p>
<p>å·¥ç¨‹å¸«ç„¡æ³•å¾åŠŸèƒ½åç¨±çŸ¥é“ã€Œæƒ…å¢ƒå¦‚ä½•è¢«å®‰æ’ã€ï¼Œä½†èƒ½ç†è§£ã€ŒåŸ·è¡Œæ¸¬è©¦æ™‚ï¼Œå°æ‡‰çš„æƒ…å¢ƒæ˜¯ä»€éº¼ã€ã€‚ä»¥å¾Œä¹Ÿä¸éœ€è¦æŠŠè¨­å®šå›¤ç©åˆ° <code>beforeEach()</code> ä¸­ã€‚</p>
<h2 id="28-going-full-circle-to-test">2.8 Going Full Circle to test()</h2>
<p>åœ¨æ”¹ç”¨å·¥å» æ¨¡å¼ä¾†å®‰æ’æ¸¬è©¦å…§å®¹å¾Œï¼Œå…¶å¯¦é€£ <code>describe()</code> éƒ½å¯ä»¥è€ƒæ…®åˆªæ‰ï¼Œå› ç‚ºæ¯ä¸€çµ„ <code>test()</code> éƒ½èƒ½èªªæ˜è‡ªå·±çš„ Arrange-Act-Assert èˆ‡ U.S.E åˆ†åˆ¥æ˜¯ä»€éº¼ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#F97583"> new</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> passingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">, reason: </span><span style="color:#9ECBFF">''</span><span style="color:#E1E4E8"> });</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">reason</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#B392F0"> fakeRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> ({ passed: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">, reason });</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(fakeRule);</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> verifier;</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing rule, has no errors'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithPassingRule</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with failed rule, has an error message based on the rule.reason'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with failed rule, has exactly one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing and failing rule, has one error'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">).</span><span style="color:#B392F0">toBe</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">1</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'pass verifier, with passing and failing rule, error text belongs to failed rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifierWithFailedRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  verifier.</span><span style="color:#B392F0">addRule</span><span style="color:#E1E4E8">(passingRule);</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'any input'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(errors[</span><span style="color:#79B8FF">0</span><span style="color:#E1E4E8">]).</span><span style="color:#B392F0">toContain</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'fake reason'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="29-refactoring-to-parameterized-tests">2.9 Refactoring to parameterized tests</h2>
<p>å‡è¨­æˆ‘å€‘å¯«äº†ä¸€å€‹å¸¶æœ‰åƒæ•¸çš„åŠŸèƒ½ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">const</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  return</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    passed: input.</span><span style="color:#B392F0">toLowerCase</span><span style="color:#E1E4E8">() </span><span style="color:#F97583">!==</span><span style="color:#E1E4E8"> input,</span></span>
<span class="line"><span style="color:#E1E4E8">    reason: </span><span style="color:#9ECBFF">'at least one upper case needed'</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#E1E4E8">};</span></span></code></pre>
<p>ä¸¦ä¸”æˆ‘å€‘æƒ³ç¢ºèªã€Œä¸ç®¡åƒæ•¸çš„å¤§å¯«ä½åœ¨ä¸€å€‹å–®å­—çš„å“ªä¸€å€‹ä½ç½®ï¼Œè©²åŠŸèƒ½éƒ½èƒ½æ­£ç¢ºåˆ¤æ–·å–®å­—æ˜¯å¦ç¬¦åˆã€è‡³å°‘åŒ…å«ä¸€å€‹å¤§å¯«å­—å…ƒã€ã€çš„è©±ï¼Œå–®å…ƒæ¸¬è©¦å¯ä»¥æœ‰è‡³å°‘ä¸‰ç¨®å¯«æ³•ã€‚</p>
<p>ç¬¬ä¸€ç¨®ï¼šä¸€å€‹æ¢ä»¶å°±æ˜¯ä¸€çµ„ <code>test()</code>ã€‚æ¢ä»¶è®ŠåŒ–å°‘çš„æ™‚å€™ç¢ºå¯¦å¯ä»¥é€™æ¨£ç©ï¼Œä½†ä¹‹å¾Œ <code>oneUpperCaseRule</code> å¦‚æœæ›´æ”¹äº†å¯¦ä½œè¦æ ¼ï¼Œå°±æœ‰ä¸€å †æ¸¬è©¦è¦èª¿æ•´ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'oneÂ uppercaseÂ rule'</span><span style="color:#E1E4E8">, </span><span style="color:#F97583">function</span><span style="color:#E1E4E8"> () {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'givenÂ noÂ uppercase,Â itÂ fails'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'givenÂ oneÂ uppercase,Â itÂ passes'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'givenÂ aÂ differentÂ uppercase,Â itÂ passes'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>ç¬¬äºŒç¨®ï¼šä½¿ç”¨ Jest çš„ <code>test.each()</code> ä¸€å£æ°£å‚³å…¥æ‰€æœ‰æƒ…å¢ƒã€‚ç›¸è¼ƒæ–¼ç¬¬ä¸€ç¨®æ¸¬è©¦çš„æ’°å¯«æ–¹å¼ï¼Œç¾åœ¨å°‘äº†å¾ˆå¤šé‡è¤‡çš„éƒ¨åˆ†ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'oneÂ uppercaseÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#B392F0">  test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'givenÂ noÂ uppercase,Â itÂ fails'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">  test.</span><span style="color:#B392F0">each</span><span style="color:#E1E4E8">([</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">, </span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">])(</span><span style="color:#9ECBFF">'givenÂ oneÂ uppercase,Â itÂ passes'</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'oneÂ uppercaseÂ rule'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">  test.</span><span style="color:#B392F0">each</span><span style="color:#E1E4E8">([</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'Abc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'aBc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">    [</span><span style="color:#9ECBFF">'abc'</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">],</span></span>
<span class="line"><span style="color:#E1E4E8">  ])(</span><span style="color:#9ECBFF">'givenÂ %s,Â %sÂ '</span><span style="color:#E1E4E8">, (</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">, </span><span style="color:#FFAB70">expected</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">    expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(expected);</span></span>
<span class="line"><span style="color:#E1E4E8">  });</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>ç¬¬ä¸‰ç¨®ï¼šä½¿ç”¨ JavaScript åŸç”Ÿçš„ <code>Object.entries</code> ä¾†ç‚ºæ¯ä¸€ç¨®æ¢ä»¶è·‘æ¸¬è©¦ã€‚</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">describe</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'oneÂ uppercaseÂ rule,Â withÂ vanillaÂ JSÂ for'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> TEST_CASE</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#E1E4E8">    Abc: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    aBc: </span><span style="color:#79B8FF">true</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">    abc: </span><span style="color:#79B8FF">false</span><span style="color:#E1E4E8">,</span></span>
<span class="line"><span style="color:#E1E4E8">  };</span></span>
<span class="line"><span style="color:#F97583">  for</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">const</span><span style="color:#E1E4E8"> [</span><span style="color:#79B8FF">input</span><span style="color:#E1E4E8">, </span><span style="color:#79B8FF">expected</span><span style="color:#E1E4E8">] </span><span style="color:#F97583">of</span><span style="color:#E1E4E8"> Object.</span><span style="color:#B392F0">entries</span><span style="color:#E1E4E8">(</span><span style="color:#79B8FF">TEST_CASE</span><span style="color:#E1E4E8">)) {</span></span>
<span class="line"><span style="color:#B392F0">    test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`givenÂ ${</span><span style="color:#E1E4E8">input</span><span style="color:#9ECBFF">},Â ${</span><span style="color:#E1E4E8">expected</span><span style="color:#9ECBFF">}`</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> oneUpperCaseRule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#B392F0">      expect</span><span style="color:#E1E4E8">(result.passed).</span><span style="color:#B392F0">toEqual</span><span style="color:#E1E4E8">(expected);</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<p>å¯«æ¸¬è©¦çš„æ–¹æ³•æœ‰å¾ˆå¤šç¨®ï¼Œèƒ½é¡§åŠç¶­è­·æ€§èˆ‡å¯è®€æ€§çš„å°±æ˜¯å¥½è¾¦æ³•ã€‚</p>
<h2 id="210-checking-for-expected-thrown-errors">2.10 Checking for expected thrown errors</h2>
<p>æ‹‰å› <code>PasswordVerifier1</code> çš„ä¾‹å­ã€‚å‡è¨­æˆ‘å€‘åœ¨ <code>verify()</code> è¿½åŠ äº†æª¢æŸ¥ <code>this.rules</code> çš„åŠŸèƒ½ï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#F97583">class</span><span style="color:#B392F0"> PasswordVerifier1</span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  constructor</span><span style="color:#E1E4E8">() {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules </span><span style="color:#F97583">=</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  addRule</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(rule);</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#B392F0">  verify</span><span style="color:#E1E4E8">(</span><span style="color:#FFAB70">input</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#6A737D">    // add this line</span></span>
<span class="line"><span style="color:#F97583">    if</span><span style="color:#E1E4E8"> (</span><span style="color:#F97583">!</span><span style="color:#79B8FF">this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#79B8FF">length</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#F97583">      throw</span><span style="color:#F97583"> new</span><span style="color:#B392F0"> Error</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'There are no rules configured'</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583">    const</span><span style="color:#79B8FF"> errors</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> [];</span></span>
<span class="line"><span style="color:#79B8FF">    this</span><span style="color:#E1E4E8">.rules.</span><span style="color:#B392F0">forEach</span><span style="color:#E1E4E8">((</span><span style="color:#FFAB70">rule</span><span style="color:#E1E4E8">) </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">      const</span><span style="color:#79B8FF"> result</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> rule</span><span style="color:#E1E4E8">(input);</span></span>
<span class="line"><span style="color:#F97583">      if</span><span style="color:#E1E4E8"> (result.passed </span><span style="color:#F97583">===</span><span style="color:#79B8FF"> false</span><span style="color:#E1E4E8">) {</span></span>
<span class="line"><span style="color:#E1E4E8">        errors.</span><span style="color:#B392F0">push</span><span style="color:#E1E4E8">(result.reason);</span></span>
<span class="line"><span style="color:#E1E4E8">      }</span></span>
<span class="line"><span style="color:#E1E4E8">    });</span></span>
<span class="line"><span style="color:#F97583">    return</span><span style="color:#E1E4E8"> errors;</span></span>
<span class="line"><span style="color:#E1E4E8">  }</span></span>
<span class="line"><span style="color:#E1E4E8">}</span></span></code></pre>
<p>ç•¶æˆ‘å€‘æƒ³è¦ç¢ºèªã€Œæ²’æœ‰è¨­å®š <code>this.rules</code> çš„è©±ï¼ŒåŸ·è¡Œ <code>this.verify()</code> æ‡‰è©²æ‹‹å‡ºéŒ¯èª¤ã€æ™‚ï¼Œå¯ä»¥ä½¿ç”¨ Jest çš„ <code>.toThrowError()</code> ä¾†æª¢æŸ¥æ˜¯å¦æœ‰æ‹‹éŒ¯ã€éŒ¯èª¤è¨Šæ¯æ˜¯å¦ç¬¦åˆé æœŸï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">test</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'verify,Â withÂ noÂ rules,Â throwsÂ exception'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> verifier</span><span style="color:#F97583"> =</span><span style="color:#B392F0"> makeVerifier</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(() </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> verifier.</span><span style="color:#B392F0">verify</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'anyÂ input'</span><span style="color:#E1E4E8">)).</span><span style="color:#B392F0">toThrowError</span><span style="color:#E1E4E8">(</span></span>
<span class="line"><span style="color:#9ECBFF">    /</span><span style="color:#DBEDFF">noÂ rulesÂ configured</span><span style="color:#9ECBFF">/</span></span>
<span class="line"><span style="color:#E1E4E8">  );</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h3 id="é¿å…ä½¿ç”¨-tomatchsnapshot">é¿å…ä½¿ç”¨ .toMatchSnapshot()</h3>
<p>ä½¿ç”¨ <code>.toMatchSnapshot()</code> ç„¡æ³•è®“äººä¸€çœ¼å°±çœ‹å‡ºè©²æ¸¬è©¦çš„é æœŸçµæœæ˜¯ä»€éº¼ã€‚å¦‚æœçœŸçš„éœ€è¦ç‚ºæ¸¬è©¦ä¿ç•™å¿«ç…§ï¼Œè«‹è€ƒæ…®ä½¿ç”¨ <code>.toMatchInlineSnapshot()</code> æ˜åˆ—é æœŸçµæœï¼š</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="js"><code><span class="line"><span style="color:#B392F0">it</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">'renders correctly'</span><span style="color:#E1E4E8">, () </span><span style="color:#F97583">=></span><span style="color:#E1E4E8"> {</span></span>
<span class="line"><span style="color:#F97583">  const</span><span style="color:#79B8FF"> tree</span><span style="color:#F97583"> =</span><span style="color:#E1E4E8"> renderer</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">create</span><span style="color:#E1E4E8">(&#x3C;</span><span style="color:#79B8FF">Link</span><span style="color:#B392F0"> page</span><span style="color:#F97583">=</span><span style="color:#9ECBFF">"https://example.com"</span><span style="color:#E1E4E8">>Example Site&#x3C;/</span><span style="color:#79B8FF">Link</span><span style="color:#E1E4E8">>)</span></span>
<span class="line"><span style="color:#E1E4E8">    .</span><span style="color:#B392F0">toJSON</span><span style="color:#E1E4E8">();</span></span>
<span class="line"><span style="color:#B392F0">  expect</span><span style="color:#E1E4E8">(tree).</span><span style="color:#B392F0">toMatchInlineSnapshot</span><span style="color:#E1E4E8">(</span><span style="color:#9ECBFF">`</span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;a</span></span>
<span class="line"><span style="color:#9ECBFF">      className="normal"</span></span>
<span class="line"><span style="color:#9ECBFF">      href="https://example.com"</span></span>
<span class="line"><span style="color:#9ECBFF">      onMouseEnter={[Function]}</span></span>
<span class="line"><span style="color:#9ECBFF">      onMouseLeave={[Function]}</span></span>
<span class="line"><span style="color:#9ECBFF">    ></span></span>
<span class="line"><span style="color:#9ECBFF">      Example Site</span></span>
<span class="line"><span style="color:#9ECBFF">    &#x3C;/a></span></span>
<span class="line"><span style="color:#9ECBFF">  `</span><span style="color:#E1E4E8">);</span></span>
<span class="line"><span style="color:#E1E4E8">});</span></span></code></pre>
<h2 id="211-setting-test-categories">2.11 Setting Test Categories</h2>
<p>Jest ç›®å‰ä¸¦ä¸æ”¯æ´ã€Œå°‡æ¸¬è©¦åˆ†é¡ï¼Œä¸¦åŸ·è¡Œç‰¹å®šé¡åˆ¥ï¼ˆä¾‹ï¼šå–®å…ƒã€æ•´åˆæ¸¬è©¦ï¼‰çš„æ¸¬è©¦ã€ã€‚ä¸éå·¥ç¨‹å¸«èƒ½é€éä»¥ä¸‹æ–¹å¼é”æˆã€Œä¾é¡åˆ¥è·‘æ¸¬è©¦ã€çš„éœ€æ±‚ï¼š</p>
<ol>
<li>è®“ä¸åŒé¡åˆ¥çš„æ¸¬è©¦æœ‰å…¶å‘½åæ¨¡å¼æˆ–æ”¶ç´è³‡æ–™å¤¾</li>
<li>åœ¨ <code>jest.config.js</code> ä¸­é€é <a href="https://jestjs.io/docs/configuration#testregex-string--arraystring">testRegex</a> æˆ–çµ‚ç«¯æŒ‡ä»¤ <a href="https://jestjs.io/docs/cli#--testpathpatternregex"><code>--testPathPattern=&#x3C;regex></code></a> ä¾†æŒ‡å®šåŸ·è¡Œç‰¹å®šåç¨±è¦å‰‡çš„æ¸¬è©¦</li>
</ol>
<h2 id="åƒè€ƒæ–‡ä»¶">åƒè€ƒæ–‡ä»¶</h2>
<ul>
<li><a href="https://www.manning.com/books/the-art-of-unit-testing-third-edition">Manning: The Art of Unit Testing, Third Edition</a></li>
</ul> </div>   <footer class="footer" data-astro-cid-qlgq3onj>
Tzu Yin (Charlie) ğŸ¦Š Made in Taiwan
</footer>  </section>  </body></html> 