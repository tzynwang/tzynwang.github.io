<!DOCTYPE html><html lang="en"> <head><meta name="astro-view-transitions-enabled" content="true"><meta name="astro-view-transitions-fallback" content="animate"><script type="module" src="/_astro/ClientRouter.astro_astro_type_script_index_0_lang.BScVxmeO.js"></script><!-- Google Tag Manager --><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ 'gtm.start': new Date().getTime(), event: 'gtm.js' });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != 'dataLayer' ? '&l=' + l : '';
        j.async = true;
        j.src = 'https://www.googletagmanager.com/gtm.js?id=' + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, 'script', 'dataLayer', ga4Id);
    })();</script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=GTM-KM9SGJLK">(function(){const gTagId = "GTM-KM9SGJLK";
})();</script><script>(function(){const ga4Id = "G-6QC9CKHCTY";

      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag('js', new Date());
      gtag('config', ga4Id);
    })();</script><!-- Global Metadata --><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ğŸ¦Š</text></svg>"><link rel="sitemap" href="/sitemap-index.xml"><meta name="generator" content="Astro v5.1.2"><!-- Primary Meta Tags --><title>2022 ç¬¬25é€± å­¸ç¿’ç­†è¨˜ï¼šåœ¨ React App ä¸­å°æ‡‰ race condition</title><meta name="title" content="2022 ç¬¬25é€± å­¸ç¿’ç­†è¨˜ï¼šåœ¨ React App ä¸­å°æ‡‰ race condition"><meta name="description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><!-- Open Graph / Facebook --><meta property="og:type" content="website"><meta property="og:url" content="https://tzynwang.github.io/2022/react-race-condition-abortcontroller"><meta property="og:title" content="2022 ç¬¬25é€± å­¸ç¿’ç­†è¨˜ï¼šåœ¨ React App ä¸­å°æ‡‰ race condition"><meta property="og:description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><meta property="og:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg"><!-- Twitter --><meta property="twitter:card" content="summary_large_image"><meta property="twitter:url" content="https://tzynwang.github.io/2022/react-race-condition-abortcontroller"><meta property="twitter:title" content="2022 ç¬¬25é€± å­¸ç¿’ç­†è¨˜ï¼šåœ¨ React App ä¸­å°æ‡‰ race condition"><meta property="twitter:description" content="é€™æ˜¯ä¸€å€‹æ–‡çµ„è½‰è·å‰ç«¯å·¥ç¨‹å¸«çš„æŠ€è¡“éƒ¨è½æ ¼"><meta property="twitter:image" content="https://tzynwang.github.io/alexander-andrews-mEdKuPYJe1I.jpg"><!-- Font --><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet"><style>.tag[data-astro-cid-2iymvi75]{position:relative;display:inline-flex;align-items:center;padding:2px 8px;font-size:14px;font-weight:400;text-decoration:none;background-color:#8aa6a3;color:#fff;transition:background-color .2s ease-in-out}.tag[data-astro-cid-2iymvi75]:not(:last-of-type){margin-right:8px}.tag[data-astro-cid-2iymvi75]:hover{background-color:#127369}
.astro-route-announcer{position:absolute;left:0;top:0;clip:rect(0 0 0 0);clip-path:inset(50%);overflow:hidden;white-space:nowrap;width:1px;height:1px}.footer[data-astro-cid-qlgq3onj]{padding:36px;text-align:center}.bottom[data-astro-cid-qlgq3onj]{position:absolute;bottom:0;left:50%;transform:translate(-50%)}.side-content[data-astro-cid-75hifxor],.main-content[data-astro-cid-75hifxor]{margin:24px}nav[data-astro-cid-75hifxor]{display:flex;gap:16px}@media screen and (min-width: 800px){body{height:100vh;display:flex;flex-direction:row;overflow-y:hidden}nav[data-astro-cid-75hifxor]{flex-direction:column}.side-content[data-astro-cid-75hifxor]{flex:0 0 240px}.main-content[data-astro-cid-75hifxor]{margin:0;padding:40px 24px 0;flex:1 1 auto;overflow-y:auto;position:relative}}*{margin:0;padding:0;box-sizing:content-box;font-family:sans-serif;text-wrap:pretty;color:#000000e6}html{background-color:#bfbfbf66}a{color:#127369;font-weight:700;text-decoration:underline;text-decoration-color:transparent;transition:text-decoration-color .2s ease-in-out}a:hover{text-decoration-color:#127369}a.link-out{position:absolute;inset:0}ul,li{list-style-position:inside}ul:not(:has(li)){margin-top:16px;margin-bottom:16px}li{margin-top:4px;margin-bottom:4px;line-height:24px}li li{padding-left:16px}img{display:block;max-width:100%}h1,h2{font-size:28px;line-height:42px;margin:16px 0;color:#4c5958}h3,h4{font-size:22px;line-height:34px;margin:16px 0;color:#4c5958}h5{font-size:18px;line-height:28px;margin:4px 0;color:#4c5958}p{font-size:16px;line-height:24px;margin:16px 0}p code{font-size:14px}blockquote{padding-left:16px;border-left:4px solid #4c5958}blockquote *{font-family:Noto Sans,sans-serif}pre{padding:8px 16px}code,code span{font-family:monospace}hr{width:100%;height:1px;margin:16px 0;background-color:#4c5958}del{color:#4c5958e6}ol>li:has(p)>p{display:inline;margin:0}
.post-container[data-astro-cid-qtokga5y] h1[data-astro-cid-qtokga5y]{margin:0 0 16px}.info[data-astro-cid-qtokga5y]{display:flex;flex-direction:column;gap:8px}.toc-container[data-astro-cid-qtokga5y]{margin-bottom:0}.toc-container[data-astro-cid-qtokga5y]>li[data-astro-cid-qtokga5y]:not(:last-of-type){margin-bottom:4px}.toc-2[data-astro-cid-qtokga5y]{margin-left:1rem}.toc-3[data-astro-cid-qtokga5y]{margin-left:2rem}.toc-4[data-astro-cid-qtokga5y]{margin-left:3rem}.toc-5[data-astro-cid-qtokga5y]{margin-left:4rem}@media screen and (min-width: 800px){.post-container[data-astro-cid-qtokga5y]{max-width:600px}}@media screen and (min-width: 1200px){.post-container[data-astro-cid-qtokga5y]{max-width:720px}}
[data-astro-image]{width:100%;height:auto;object-fit:var(--fit);object-position:var(--pos);aspect-ratio:var(--w) / var(--h)}[data-astro-image=responsive]{max-width:calc(var(--w) * 1px);max-height:calc(var(--h) * 1px)}[data-astro-image=fixed]{width:calc(var(--w) * 1px);height:calc(var(--h) * 1px)}
</style></head> <body> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KM9SGJLK" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <section class="side-content" data-astro-cid-75hifxor> <h1 data-astro-cid-75hifxor>æ™®é€šæ–‡çµ„ 2.0</h1> <nav data-astro-cid-75hifxor> <a href="/" data-astro-cid-75hifxor>é¦–é </a> <a href="/archive" data-astro-cid-75hifxor>å…¨æ–‡ç« æ­¸æª”</a> <a href="/tag" data-astro-cid-75hifxor>ä»¥æ¨™ç±¤æª¢è¦–</a> <a href="/rss.xml" data-astro-cid-75hifxor>RSS</a> </nav> </section> <section class="main-content" data-astro-cid-75hifxor>   <div class="post-container" data-astro-cid-qtokga5y> <h1 data-astro-cid-qtokga5y>2022 ç¬¬25é€± å­¸ç¿’ç­†è¨˜ï¼šåœ¨ React App ä¸­å°æ‡‰ race condition</h1> <div class="info" data-astro-cid-qtokga5y> <span data-astro-cid-qtokga5y>2022-06-25 12:01</span> <span data-astro-cid-qtokga5y><a class="tag" href="/tag/React" data-astro-cid-2iymvi75> React </a> </span> <ul class="toc-container" data-astro-cid-qtokga5y> <li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç¸½çµ" data-astro-cid-qtokga5y>ç¸½çµ</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#ç­†è¨˜" data-astro-cid-qtokga5y>ç­†è¨˜</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#æƒ…å¢ƒæè¿°" data-astro-cid-qtokga5y>æƒ…å¢ƒæè¿°</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#è§£æ³•" data-astro-cid-qtokga5y>è§£æ³•</a> </li><li class="toc-3" data-astro-cid-qtokga5y> <a href="#é—œæ–¼-race-condition" data-astro-cid-qtokga5y>é—œæ–¼ race condition</a> </li><li class="toc-2" data-astro-cid-qtokga5y> <a href="#åƒè€ƒæ–‡ä»¶" data-astro-cid-qtokga5y>åƒè€ƒæ–‡ä»¶</a> </li> </ul> </div> <h2 id="ç¸½çµ">ç¸½çµ</h2>
<p>æœ€è¿‘æ’åˆ° race condition çš„å‘ï¼Œè¨˜éŒ„ä¸€ä¸‹åœ¨ä½¿ç”¨ react æ­é… axios é–‹ç™¼æ™‚å¯ä»¥æ€éº¼è§£æ±º</p>
<h2 id="ç­†è¨˜">ç­†è¨˜</h2>
<h3 id="æƒ…å¢ƒæè¿°">æƒ…å¢ƒæè¿°</h3>
<ul>
<li>å‰ç«¯æ ¹æ“š url ä¸­çš„ <code>contendId_X</code> å‘å¾Œç«¯ç´¢å–å°æ‡‰è³‡æ–™ï¼ˆ <code>contendId_X</code> å°æ‡‰çš„è³‡æ–™é‡ç›¸å°é¾å¤§ï¼Œå¾Œç«¯ç„¡æ³•é¦¬ä¸Šå›æ‡‰ï¼‰ï¼›ä½†åœ¨å¾Œç«¯å›å‚³å°æ‡‰å…§å®¹å‰ï¼Œä½¿ç”¨è€…å°±é›¢é–‹äº†è©²ç•«é¢</li>
<li>ä½¿ç”¨è€…é€²å…¥äº†å¦ä¸€å€‹ç•«é¢ï¼Œå‰ç«¯æ ¹æ“šæ–°çš„ <code>contentId_Y</code> å‘å¾Œç«¯ç´¢å–è³‡æ–™</li>
<li>å¾Œç«¯å…ˆå›å‚³äº† <code>contentId_Y</code> çš„è³‡æ–™ï¼Œéš¨å¾Œæ‰å›å‚³ <code>contendId_X</code> çš„çµæœï¼Œé€ æˆç•«é¢ä¸Šçš„å…§å®¹ä¸æ­£ç¢º</li>
</ul>
<h3 id="è§£æ³•">è§£æ³•</h3>
<ul>
<li>57 è¡Œï¼šé€²å…¥ç•«é¢æ™‚ï¼Œæ¯”å° url ä¸­çš„ <code>contentId</code> èˆ‡å¾Œç«¯å›å‚³çš„å…§å®¹çš„ <code>contentId</code> æ˜¯å¦ä¸€è‡´ï¼Œå…©é‚Šçš„ <code>contentId</code> ä¸åŒæ™‚ï¼Œå°±ä¸æ‡‰è©²æ›´æ–°ç”¨ä¾†ä¿å­˜è³‡æ–™çš„ states è®Šæ•¸</li>
<li>65 è¡Œï¼šç›£è½ url ç‹€æ…‹ï¼Œä¸€æ—¦ä½¿ç”¨è€…é¸æ“‡ç€è¦½åˆ°å…¶ä»– url ï¼Œå°±é€é <code>AbortController.abort()</code> å–æ¶ˆå·²ç¶“é€å‡ºçš„ request</li>
<li>66 è¡Œï¼šæ‰¿ä¸Šï¼Œä¸€æ—¦ä½¿ç”¨è€…é¸æ“‡ç€è¦½åˆ°å…¶ä»– url ï¼Œå°±å°‡ä¿å­˜è³‡æ–™ç”¨çš„ states è®Šæ•¸å›æ­¸åˆ°é è¨­ç‹€æ…‹ï¼Œé¿å…ä½¿ç”¨è€…åœ¨æ–°ç•«é¢çœ‹åˆ°èˆŠç•«é¢çš„è³‡æ–™</li>
<li>å®Œæ•´å…§å®¹å¯åƒè€ƒ <a href="https://github.com/tzynwang/react-deal-with-race-condition">tzynwang/react-deal-with-race-condition</a></li>
</ul>
<script src="https://gist.github.com/tzynwang/0488ab7b41d06d52f83afa7022c85905.js"></script>
<h3 id="é—œæ–¼-race-condition">é—œæ–¼ race condition</h3>
<blockquote>
<p>Wikipedia: A race condition (or race hazard) is the condition of an electronics, software, or other system where the systemâ€™s substantive behavior is dependent on the sequence or timing of other <strong>uncontrollable events</strong>. It becomes a bug when one or more of the possible behaviors is undesirable.</p>
</blockquote>
<blockquote>
<p>StackOverFlow: A race condition occurs when two or more threads can <strong>access shared data</strong> and they <strong>try to change it at the same time</strong>. Because the thread scheduling algorithm can swap between threads at any time, you donâ€™t know the order in which the threads will attempt to access the shared data. Therefore, the result of the change in data is dependent on the thread scheduling algorithm, i.e. both threads are â€œracingâ€ to access/change the data.</p>
</blockquote>
<ul>
<li>è§£é‡‹ï¼ˆæ¯”å–»ï¼‰ï¼š
<ul>
<li>å†°ç®±è£¡çš„ç‰›å¥¶æ²’äº†ï¼Œä½ å…ˆç™¼ç¾é€™ä»¶äº‹ï¼Œå‡ºé–€æº–å‚™è²·ä¸€ç“¶é®®å¥¶ï¼›æ¥è‘—ä½ å®¤å‹ä¹Ÿçœ‹åˆ°å†°ç®±è£¡æ²’æœ‰é®®å¥¶äº†ï¼Œæ–¼æ˜¯ä»–ä¹Ÿå‡ºé–€æº–å‚™è²·ä¸€ç“¶ï¼›æœ€å¾Œå†°ç®±è£¡æœ‰å…©ç“¶é®®å¥¶ã€‚</li>
<li>å…¶å¯¦åªéœ€è¦è£œä¸€ç“¶é®®å¥¶åˆ°å†°ç®±å°±å¥½ï¼Œå¯æ˜¯ä½ è·Ÿä½ çš„å®¤å‹éƒ½è§€æ¸¬åˆ°ã€Œå†°ç®±æ²’æœ‰é®®å¥¶ã€é€™å€‹äº‹ä»¶ï¼Œä¸”å…©å€‹äººéƒ½å‡ºç™¼å»è²·é®®å¥¶ã€‚</li>
</ul>
</li>
<li>è§£æ±ºè¾¦æ³•ï¼ˆæ¯”å–»ï¼‰ï¼š
<ul>
<li>ä»»ä½•ç™¼ç¾å†°ç®±æ²’æœ‰ç‰›å¥¶çš„äººï¼Œéƒ½å…ˆæŠŠå†°ç®±æ•´å€‹é–èµ·ä¾†ï¼ˆcritical sectionï¼‰ï¼Œç­‰åˆ°è²·å¥½é®®å¥¶å›å®¶å¾Œï¼Œå†è§£é–‹å†°ç®±çš„é–ï¼ŒæŠŠç‰›å¥¶æ”¾é€²å»ï¼›é€™æ¨£å°±ä¸æœƒæœ‰ã€Œæ„å¤–å¤šè²·ä¸€ç“¶é®®å¥¶ã€çš„å•é¡Œç™¼ç”Ÿäº†ã€‚</li>
<li>critical section (by Wikipedia): In concurrent programming, concurrent accesses to shared resources can lead to unexpected or erroneous behavior, so parts of the program where the shared resource is accessed need to be protected in ways that avoid the concurrent access. One way to do so is known as a critical section or critical region. This protected section <strong>cannot be entered by more than one process or thread at a time</strong>; others are suspended until the first leaves the critical section.</li>
</ul>
</li>
</ul>
<h2 id="åƒè€ƒæ–‡ä»¶">åƒè€ƒæ–‡ä»¶</h2>
<ul>
<li><a href="https://en.wikipedia.org/wiki/Race_condition">Wikipedia: Race condition</a></li>
<li><a href="https://stackoverflow.com/questions/34510/what-is-a-race-condition">StackOverFlow: What is a race condition?</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortController">MDN: AbortController</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/AbortSignal">MDN: AbortSignal</a></li>
<li><a href="https://maxrozen.com/race-conditions-fetching-data-react-with-useeffect#fixing-the-useeffect-race-condition=">Fixing Race Conditions in React with useEffect</a></li>
<li><a href="https://youtu.be/MqnpIwN7dz0">YouTube: Race Conditions and How to Prevent Them - A Look at Dekkerâ€™s Algorithm</a></li>
</ul> </div>   <footer class="footer" data-astro-cid-qlgq3onj>
Tzu Yin (Charlie) ğŸ¦Š Made in Taiwan
</footer>  </section>  </body></html> 